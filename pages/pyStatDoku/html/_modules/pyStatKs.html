<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyStatKs &mdash; pyStatKs 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="pyStatKs 0.1 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../pyStatKs.html">pyStatKs 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pyStatKs</h1><div class="highlight"><pre>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;kos&#39;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">small_util_routines</span>
    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">Tkinter</span> <span class="kn">as</span> <span class="nn">tk</span>
    <span class="kn">from</span> <span class="nn">Tkinter</span> <span class="kn">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">tkFileDialog</span> <span class="kn">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">nhlscrapi.games.game</span> <span class="kn">import</span> <span class="n">Game</span><span class="p">,</span> <span class="n">GameKey</span><span class="p">,</span> <span class="n">GameType</span>
    <span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">small_util_routines</span>
    <span class="kn">import</span> <span class="nn">copy</span> <span class="kn">as</span> <span class="nn">cp</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">print</span> <span class="ne">ImportError</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">getter</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&#39;Module not found&#39;</span><span class="p">)</span>


<span class="n">critical</span><span class="o">=</span><span class="mi">1</span>
<span class="n">nonCritical</span><span class="o">=</span><span class="mi">0</span>

<span class="n">GLOBAL_VERBOSITY_LEVEL</span><span class="o">=</span><span class="mi">1</span>

<span class="n">utC</span><span class="o">=</span><span class="n">small_util_routines</span><span class="p">(</span><span class="n">GLOBAL_VERBOSITY_LEVEL</span><span class="p">)</span>
<span class="n">VerbosityF</span><span class="o">=</span><span class="n">utC</span><span class="o">.</span><span class="n">VerbosityF</span>
<span class="n">ToassertF</span><span class="o">=</span><span class="n">utC</span><span class="o">.</span><span class="n">ToassertF</span>
<span class="n">EnumF</span><span class="o">=</span><span class="n">utC</span><span class="o">.</span><span class="n">EnumF</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    this class implements harvesting and</span>
<span class="sd">    processing routines for NHL game data</span>

<span class="sd">    for fetching NHL data the nhlscrapi class</span>
<span class="sd">    has been used</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="MinerC"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MinerC">[docs]</a><span class="k">class</span> <span class="nc">MinerC</span><span class="p">():</span>


    <span class="sd">&quot;&quot;&quot; class for mining NHL game data&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seasonList</span><span class="p">,</span><span class="n">withPlayoffGames</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;initialize data structures for data scraping&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        input:</span>
<span class="sd">            season: 4 digit number indicating the season or string &quot;all&quot;</span>
<span class="sd">            withPlayoffGames:       True or False, if with or without postseason results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileNamePrefix</span><span class="o">=</span><span class="s">&quot;dataFileNhl_&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileNamePostfix</span><span class="o">=</span><span class="s">&quot;.dat&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_actualSeason</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span><span class="o">=</span><span class="s">&quot;&quot;</span>

        <span class="sd">&quot;&quot;&quot;_includingPlayoffGames: true: with playoff games for that season&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">withPlayoffGames</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_includingPlayoffGames</span><span class="o">=</span><span class="bp">True</span>

        <span class="k">if</span> <span class="n">seasonList</span><span class="o">==</span><span class="s">&quot;all&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seasonList</span><span class="o">=</span><span class="p">[</span><span class="mi">2010</span><span class="p">,</span><span class="mi">2011</span><span class="p">,</span><span class="mi">2012</span><span class="p">,</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2014</span><span class="p">,</span><span class="mi">2015</span><span class="p">,</span><span class="mi">2016</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seasonList</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seasonList</span><span class="o">=</span><span class="p">[</span><span class="n">seasonList</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#do nothing - empty list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seasonList</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">if</span> <span class="n">withPlayoffGames</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gameTypeList</span><span class="o">=</span><span class="p">[</span><span class="n">GameType</span><span class="o">.</span><span class="n">Regular</span><span class="p">,</span><span class="n">GameType</span><span class="o">.</span><span class="n">Playoffs</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gameTypeList</span><span class="o">=</span><span class="p">[</span><span class="n">GameType</span><span class="o">.</span><span class="n">Regular</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_gameId</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_relativeDate</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_homeTeam</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_awayTeam</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_homeWin</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_score_diff</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shots_dif</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_diff_fo</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deltaTA</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deltaGA</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deltaPM</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deltaHT</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deltaPM</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delta_ppgoals</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attendance</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_GAMENUMAX</span><span class="o">=</span><span class="mi">1200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_actualGameType</span><span class="o">=</span><span class="mi">0</span>


<div class="viewcode-block" id="MinerC.mine_data"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MinerC.mine_data">[docs]</a>    <span class="k">def</span> <span class="nf">mine_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>


        <span class="sd">&quot;&quot;&quot; main mining routine in mining class - fetches data using nhlscrapi &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seasonList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_actualSeason</span><span class="o">=</span><span class="n">season</span>
            <span class="c">#for every season we set the gameID to zero</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gameId</span><span class="o">=</span><span class="mi">0</span>
            <span class="c">#create files for added and delta values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">(</span><span class="n">plusMinus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">(</span><span class="n">plusMinus</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Mine for data in season &quot;</span><span class="p">,</span><span class="n">season</span><span class="p">)</span>

            <span class="k">for</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actualGameType</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gameTypeList</span><span class="p">:</span>
                <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Fetching data for game type &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_actualGameType</span><span class="p">)</span>
                <span class="c">#number of games per season is stored in constant of NHLscrapi</span>
                <span class="c">#ToassertF(C.GAME_CT_DICT[season]==0,nonCritical,&quot;no games for season &quot;,season)</span>
                <span class="n">gameNum</span><span class="o">=</span><span class="mi">0</span>
                <span class="c">#for gameNum in range(self._GAMENUMAX):</span>
                <span class="n">coachName</span><span class="o">=</span><span class="s">&quot;noCoach&quot;</span>
                <span class="k">while</span> <span class="n">gameNum</span> <span class="o">&lt;</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_GAMENUMAX</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">coachName</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">gameNum</span><span class="o">=</span><span class="n">gameNum</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">game_key</span><span class="o">=</span><span class="n">GameKey</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_actualSeason</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_actualGameType</span><span class="p">,</span><span class="n">gameNum</span><span class="p">)</span>
                    <span class="n">gameObj</span><span class="o">=</span><span class="n">Game</span><span class="p">(</span><span class="n">game_key</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">coachName</span><span class="o">=</span><span class="n">Game</span><span class="p">(</span><span class="n">GameKey</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_actualSeason</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_actualGameType</span><span class="p">,</span><span class="n">gameNum</span><span class="p">))</span><span class="o">.</span><span class="n">away_coach</span>
                        <span class="c">#exist=isinstance(gameObj.plays,list)</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">coachName</span><span class="o">=</span><span class="s">&quot;&quot;</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">coachName</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
                    <span class="c">#for gameNum in range(1,C.GAME_CT_DICT[season]+1):</span>
                        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Fetching data for game &quot;</span><span class="p">,</span><span class="n">gameNum</span><span class="p">)</span>
                        <span class="n">do_print</span><span class="o">=</span><span class="mi">1</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">gameObj</span><span class="o">.</span><span class="n">load_all</span><span class="p">()</span>
                            <span class="n">dateOfMatch</span><span class="o">=</span><span class="n">gameObj</span><span class="o">.</span><span class="n">matchup</span><span class="p">[</span><span class="s">&quot;date&quot;</span><span class="p">]</span>
                            <span class="n">gameDateReformatted</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getGameDate</span><span class="p">(</span><span class="n">dateOfMatch</span><span class="p">)</span>
                            <span class="n">referenceDate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getReferenceDate</span><span class="p">(</span><span class="n">season</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_relativeDate</span><span class="o">=</span><span class="p">(</span><span class="n">gameDateReformatted</span><span class="o">-</span><span class="n">referenceDate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
                            <span class="n">sumDict</span><span class="o">=</span><span class="n">gameObj</span><span class="o">.</span><span class="n">event_summary</span>
                            <span class="c">#sumDict=nhl.games.eventsummary.EventSummary(game_key)</span>
                            <span class="c">#faceoff statistics</span>
                            <span class="n">sumgameDict</span><span class="o">=</span><span class="n">sumDict</span><span class="o">.</span><span class="n">totals</span><span class="p">()</span>
                            <span class="c">#sumgameDict=nhl.games.game.EventSummary(game_key).totals()</span>
                            <span class="n">takeAwaysHome</span><span class="o">=</span><span class="n">sumgameDict</span><span class="p">[</span><span class="s">&quot;home&quot;</span><span class="p">][</span><span class="s">&quot;tk&quot;</span><span class="p">]</span>
                            <span class="n">takeAwaysAway</span><span class="o">=</span><span class="n">sumgameDict</span><span class="p">[</span><span class="s">&quot;away&quot;</span><span class="p">][</span><span class="s">&quot;tk&quot;</span><span class="p">]</span>
                            <span class="n">giveAwaysHome</span><span class="o">=</span><span class="n">sumgameDict</span><span class="p">[</span><span class="s">&quot;home&quot;</span><span class="p">][</span><span class="s">&quot;gv&quot;</span><span class="p">]</span>
                            <span class="n">giveAwaysAway</span><span class="o">=</span><span class="n">sumgameDict</span><span class="p">[</span><span class="s">&quot;away&quot;</span><span class="p">][</span><span class="s">&quot;gv&quot;</span><span class="p">]</span>
                            <span class="n">pimHome</span><span class="o">=</span><span class="n">sumgameDict</span><span class="p">[</span><span class="s">&quot;home&quot;</span><span class="p">][</span><span class="s">&quot;pim&quot;</span><span class="p">]</span>
                            <span class="n">pimAway</span><span class="o">=</span><span class="n">sumgameDict</span><span class="p">[</span><span class="s">&quot;away&quot;</span><span class="p">][</span><span class="s">&quot;pim&quot;</span><span class="p">]</span>
                            <span class="n">hitHome</span><span class="o">=</span><span class="n">sumgameDict</span><span class="p">[</span><span class="s">&quot;home&quot;</span><span class="p">][</span><span class="s">&quot;ht&quot;</span><span class="p">]</span>
                            <span class="n">hitAway</span><span class="o">=</span><span class="n">sumgameDict</span><span class="p">[</span><span class="s">&quot;away&quot;</span><span class="p">][</span><span class="s">&quot;ht&quot;</span><span class="p">]</span>
                            <span class="n">afo</span><span class="o">=</span><span class="n">sumDict</span><span class="o">.</span><span class="n">away_fo</span>
                            <span class="n">hfo</span><span class="o">=</span><span class="n">sumDict</span><span class="o">.</span><span class="n">home_fo</span>
                            <span class="n">hfov</span><span class="o">=</span><span class="n">hfo</span><span class="p">[</span><span class="s">&quot;ev&quot;</span><span class="p">][</span><span class="s">&quot;won&quot;</span><span class="p">]</span>
                            <span class="n">afov</span><span class="o">=</span><span class="n">afo</span><span class="p">[</span><span class="s">&quot;ev&quot;</span><span class="p">][</span><span class="s">&quot;won&quot;</span><span class="p">]</span>
                            <span class="n">score_hometeam</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">gameObj</span><span class="o">.</span><span class="n">matchup</span><span class="p">[</span><span class="s">&quot;final&quot;</span><span class="p">][</span><span class="s">&quot;home&quot;</span><span class="p">])</span>
                            <span class="n">score_awayteam</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">gameObj</span><span class="o">.</span><span class="n">matchup</span><span class="p">[</span><span class="s">&quot;final&quot;</span><span class="p">][</span><span class="s">&quot;away&quot;</span><span class="p">])</span>
                            <span class="c">#sumgame=nhl.games.game.EventSummary(game_key)</span>
                            <span class="n">ppgoalsHomeTeam</span><span class="o">=</span><span class="n">sumDict</span><span class="o">.</span><span class="n">home_shots</span><span class="p">[</span><span class="s">&#39;agg&#39;</span><span class="p">][</span><span class="s">&#39;pp&#39;</span><span class="p">][</span><span class="s">&#39;g&#39;</span><span class="p">]</span>
                            <span class="n">ppgoalsAwayTeam</span><span class="o">=</span><span class="n">sumDict</span><span class="o">.</span><span class="n">away_shots</span><span class="p">[</span><span class="s">&#39;agg&#39;</span><span class="p">][</span><span class="s">&#39;pp&#39;</span><span class="p">][</span><span class="s">&#39;g&#39;</span><span class="p">]</span>
                            <span class="n">shotsHome</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sumgameDict</span><span class="p">[</span><span class="s">&quot;home&quot;</span><span class="p">][</span><span class="s">&quot;s&quot;</span><span class="p">])</span>
                            <span class="n">shotsAway</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sumgameDict</span><span class="p">[</span><span class="s">&quot;away&quot;</span><span class="p">][</span><span class="s">&quot;s&quot;</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_homeTeam</span><span class="o">=</span><span class="n">gameObj</span><span class="o">.</span><span class="n">matchup</span><span class="p">[</span><span class="s">&quot;home&quot;</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_awayTeam</span><span class="o">=</span><span class="n">gameObj</span><span class="o">.</span><span class="n">matchup</span><span class="p">[</span><span class="s">&quot;away&quot;</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_attendance</span><span class="o">=</span><span class="n">gameObj</span><span class="o">.</span><span class="n">matchup</span><span class="p">[</span><span class="s">&quot;attendance&quot;</span><span class="p">]</span>

                        <span class="k">except</span><span class="p">:</span>
                        <span class="c">#do nothing - simply do not print the current dataset</span>
                            <span class="n">do_print</span><span class="o">=</span><span class="mi">0</span>

    <span class="c"># we print two files - one with summed, one with delta values</span>
                        <span class="k">for</span> <span class="n">plusMinus</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hfov</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_diff_fo</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">hfov</span><span class="p">)</span><span class="o">-</span><span class="n">plusMinus</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">afov</span><span class="p">)</span>
                            <span class="c">#else:</span>
                            <span class="c">#    self._diff_fo=&quot;NAN&quot;</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">_deltaTA</span><span class="o">=</span><span class="n">takeAwaysHome</span><span class="o">-</span><span class="n">plusMinus</span><span class="o">*</span><span class="n">takeAwaysAway</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_deltaGA</span><span class="o">=</span><span class="n">giveAwaysHome</span><span class="o">-</span><span class="n">plusMinus</span><span class="o">*</span><span class="n">giveAwaysAway</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_deltaPM</span><span class="o">=</span><span class="n">pimHome</span><span class="o">-</span><span class="n">plusMinus</span><span class="o">*</span><span class="n">pimAway</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_deltaHT</span><span class="o">=</span><span class="n">hitHome</span><span class="o">-</span><span class="n">plusMinus</span><span class="o">*</span><span class="n">hitAway</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_score_diff</span><span class="o">=</span><span class="n">score_hometeam</span><span class="o">-</span><span class="n">plusMinus</span><span class="o">*</span><span class="n">score_awayteam</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_delta_ppgoals</span><span class="o">=</span><span class="n">ppgoalsHomeTeam</span><span class="o">-</span><span class="n">plusMinus</span><span class="o">*</span><span class="n">ppgoalsAwayTeam</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_shots_diff</span><span class="o">=</span><span class="n">shotsHome</span><span class="o">-</span><span class="n">plusMinus</span><span class="o">*</span><span class="n">shotsAway</span>

                            <span class="k">if</span> <span class="n">plusMinus</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">haveWonLambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">k</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_homeHasWon</span><span class="o">=</span><span class="n">haveWonLambda</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_score_diff</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_gameId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gameId</span><span class="o">+</span><span class="mi">1</span>

                            <span class="c">#now print this dataset</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">do_print</span><span class="p">,</span><span class="n">plusMinus</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="MinerC.getGameDate"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MinerC.getGameDate">[docs]</a>    <span class="k">def</span> <span class="nf">getGameDate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gameDate</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get the date of the game in the python date format&quot;&quot;&quot;</span>

        <span class="n">dateList</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">gameDate</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">year</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dateList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">day</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dateList</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">monthStr</span><span class="o">=</span><span class="n">dateList</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">monthList</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;January&quot;</span><span class="p">,</span><span class="s">&quot;February&quot;</span><span class="p">,</span><span class="s">&quot;March&quot;</span><span class="p">,</span><span class="s">&quot;April&quot;</span><span class="p">,</span><span class="s">&quot;May&quot;</span><span class="p">,</span><span class="s">&quot;June&quot;</span><span class="p">,</span><span class="s">&quot;July&quot;</span><span class="p">,</span><span class="s">&quot;August&quot;</span><span class="p">,</span><span class="s">&quot;September&quot;</span>
        <span class="p">,</span><span class="s">&quot;October&quot;</span><span class="p">,</span><span class="s">&quot;November&quot;</span><span class="p">,</span><span class="s">&quot;December&quot;</span><span class="p">]</span>
        <span class="n">monthVal</span> <span class="o">=</span> <span class="n">monthList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">monthStr</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">dateOfGame</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">monthVal</span><span class="p">,</span><span class="n">day</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dateOfGame</span>
</div>
<div class="viewcode-block" id="MinerC.getReferenceDate"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MinerC.getReferenceDate">[docs]</a>    <span class="k">def</span> <span class="nf">getReferenceDate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">season</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reference date to which date of every game is calculated&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">date</span><span class="p">(</span><span class="n">season</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MinerC.write_header"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MinerC.write_header">[docs]</a>    <span class="k">def</span> <span class="nf">write_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plusMinus</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;write output file header&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assembleFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_actualSeason</span><span class="p">,</span><span class="n">plusMinus</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span><span class="p">,</span><span class="s">&quot;w+&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ID </span><span class="se">\t</span><span class="s"> season </span><span class="se">\t</span><span class="s"> Date </span><span class="se">\t</span><span class="s"> homeTeam </span><span class="se">\t</span><span class="s"> awayTeam </span><span class="se">\t</span><span class="s"> WonYN </span><span class="se">\t</span><span class="s"> ScoreDiff </span><span class="se">\t</span><span class="s"> ShDiff </span><span class="se">\t</span><span class="s"> FacoffDiff </span><span class="se">\t</span><span class="s"> TakeawayDiff </span><span class="se">\t</span><span class="s"> </span><span class="se">\</span>
<span class="s">            GiveawaysDiff </span><span class="se">\t</span><span class="s"> PenaltyminutesDiff </span><span class="se">\t</span><span class="s"> HitsDiff </span><span class="se">\t</span><span class="s"> powerplayGoalsDiff </span><span class="se">\t</span><span class="s"> Attendance&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;I/O error({0}): {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errno</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">strerror</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">raise</span>

</div>
<div class="viewcode-block" id="MinerC.assembleFileName"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MinerC.assembleFileName">[docs]</a>    <span class="k">def</span> <span class="nf">assembleFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thisSeason</span><span class="p">,</span><span class="n">plusMinus</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        assemble name of output file</span>
<span class="sd">        input:</span>
<span class="sd">        season: 4 digit number specifying season e.g. 2010</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actualGameType</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">_gameTypeList</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">addString</span><span class="o">=</span><span class="s">&quot;_regular&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">addString</span><span class="o">=</span><span class="s">&quot;_postSeason&quot;</span>

        <span class="k">if</span> <span class="n">plusMinus</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileNamePrefix</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">thisSeason</span><span class="p">),</span><span class="n">addString</span><span class="p">,</span><span class="s">&quot;_delta&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileNamePostfix</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileNamePrefix</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">thisSeason</span><span class="p">),</span><span class="n">addString</span><span class="p">,</span><span class="s">&quot;_sum&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileNamePostfix</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="MinerC.write_data"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MinerC.write_data">[docs]</a>    <span class="k">def</span> <span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">doPrint</span><span class="p">,</span><span class="n">plusMinus</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write data in ascii format into output file</span>
<span class="sd">        :rtype : object</span>
<span class="sd">        input:</span>
<span class="sd">        doPrint: 0 or 1, if dataset should be dumped to file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assembleFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_actualSeason</span><span class="p">,</span><span class="n">plusMinus</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">doPrint</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span><span class="p">,</span><span class="s">&quot;a+&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="c">#ID season Date homeTeam awayTeam WonYN ScoreDiff ShDiff FacoffDiff TakeawayDiff GiveawaysDiff PenaltyminutesDiff HitsDiff powerPlayGoals Attendance</span>


                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gameId</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_actualSeason</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_relativeDate</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_homeTeam</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_awayTeam</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_homeHasWon</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_score_diff</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shots_diff</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_diff_fo</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deltaTA</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deltaGA</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deltaPM</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deltaHT</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_delta_ppgoals</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                        <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attendance</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;I/O error({0}): {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errno</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">strerror</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Could not convert data to an string.&quot;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">raise</span>
</div></div>
<div class="viewcode-block" id="prepareDataC"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.prepareDataC">[docs]</a><span class="k">class</span> <span class="nc">prepareDataC</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;prepare data for use in statistical analysis&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seasonList</span><span class="p">,</span><span class="n">readUsingTK</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;initialize local variables&quot;&quot;&quot;</span>

        <span class="c">#self.MinerC=MinerC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDict</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDictPostSeason</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDictSUM</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDictPostSeasonSUM</span><span class="o">=</span><span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_seasonList</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seasonList</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seasonList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seasonList</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seasonList</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">listElement</span> <span class="ow">in</span> <span class="n">seasonList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_seasonList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listElement</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">seasonList</span><span class="o">==</span><span class="s">&quot;all&quot;</span><span class="p">:</span>
            <span class="c">#look for all files in current folder and fetch the seasons</span>
            <span class="n">currentPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="n">allSeasonList</span><span class="o">=</span><span class="p">[</span><span class="mi">2008</span><span class="p">,</span><span class="mi">2009</span><span class="p">,</span><span class="mi">2010</span><span class="p">,</span><span class="mi">2011</span><span class="p">,</span><span class="mi">2012</span><span class="p">,</span><span class="mi">2013</span><span class="p">,</span><span class="mi">2014</span><span class="p">,</span><span class="mi">2015</span><span class="p">,</span><span class="mi">2016</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="n">allSeasonList</span><span class="p">:</span>
                <span class="n">filename</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">currentPath</span><span class="o">+</span><span class="s">&quot;/dataSetsNHL/dataFileNhl_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">season</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;_regular_delta.dat&quot;</span><span class="p">)</span>
                <span class="c">#now check if file exists</span>
                <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;check if file &quot;</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="s">&quot; exists!&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                    <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;file &quot;</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="s">&quot; exists!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_seasonList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">season</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;file &quot;</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="s">&quot; NOT FOUND in current directory!&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDictPostSeason</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDictSUM</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDictPostSeasonSUM</span><span class="o">=</span><span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedCorrelated</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedUnCorrelated</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedUniformUncorrelated</span><span class="o">=</span><span class="p">{}</span>

        <span class="c">#now read the data as given in the input</span>
        <span class="n">file_path</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">readUsingTK</span><span class="p">:</span>
        <span class="c">#now read using an open dialog</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
            <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">askopenfilename</span><span class="p">()</span>

        <span class="c">#file_path is empty if not read by TK</span>
        <span class="c">#else the filename is guessed by using the internal</span>
        <span class="c">#list of seasons in self._seasonList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readInput</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="n">readUsingTK</span><span class="p">)</span>

        <span class="c">#self._gesamtInputDatenDict=gesamtInputDatenDict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">=</span><span class="n">EnumF</span><span class="p">(</span><span class="s">&quot;ID&quot;</span><span class="p">,</span><span class="s">&quot;season&quot;</span><span class="p">,</span><span class="s">&quot;date&quot;</span><span class="p">,</span><span class="s">&quot;homeTeam&quot;</span><span class="p">,</span><span class="s">&quot;awayTeam&quot;</span><span class="p">,</span><span class="s">&quot;wonYN&quot;</span><span class="p">,</span><span class="s">&quot;ScoreDiff&quot;</span><span class="p">,</span><span class="s">&quot;ShDiff&quot;</span><span class="p">,</span><span class="s">&quot;FaceoffDiff&quot;</span><span class="p">,</span><span class="s">&quot;TakeawayDiff&quot;</span><span class="p">,</span> \
     <span class="s">&quot;GiveawaysDiff&quot;</span><span class="p">,</span><span class="s">&quot;PenaltyminutesDiff&quot;</span><span class="p">,</span><span class="s">&quot;HitsDiff&quot;</span><span class="p">,</span><span class="s">&quot;powerplayGoalsDiff&quot;</span><span class="p">,</span><span class="s">&quot;Attendance&quot;</span><span class="p">)</span>

    <span class="c">#    self._ENList=[&quot;ID&quot;,&quot;season&quot;,&quot;date&quot;,&quot;homeTeam&quot;,&quot;awayTeam&quot;,&quot;wonYN&quot;,&quot;ScoreDiff&quot;,&quot;ShDiff&quot;,&quot;FaceoffDiff&quot;,&quot;TakeawayDiff&quot;, \</span>
    <span class="c"># &quot;GiveawaysDiff&quot;,&quot;PenaltyminutesDiff&quot;,&quot;HitsDiff&quot;,&quot;powerplayGoalsDiff&quot;,&quot;Attendance&quot;]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ENList</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;ID&quot;</span><span class="p">,</span><span class="s">&quot;season&quot;</span><span class="p">,</span><span class="s">&quot;date&quot;</span><span class="p">,</span><span class="s">&quot;homeTeam&quot;</span><span class="p">,</span><span class="s">&quot;awayTeam&quot;</span><span class="p">,</span><span class="s">&quot;wonYN&quot;</span><span class="p">,</span><span class="s">&quot;score&quot;</span><span class="p">,</span><span class="s">&quot;shots&quot;</span><span class="p">,</span><span class="s">&quot;faceoffs&quot;</span><span class="p">,</span><span class="s">&quot;takeaways&quot;</span><span class="p">,</span> \
     <span class="s">&quot;giveaways&quot;</span><span class="p">,</span><span class="s">&quot;penaltyminutes&quot;</span><span class="p">,</span><span class="s">&quot;hits&quot;</span><span class="p">,</span><span class="s">&quot;powerplay goals&quot;</span><span class="p">,</span><span class="s">&quot;attendance&quot;</span><span class="p">]</span>

        <span class="c">#print self._EN.ID,self._EN.season,self._EN.date</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_DataSetType</span><span class="o">=</span><span class="n">EnumF</span><span class="p">(</span><span class="s">&quot;delta&quot;</span><span class="p">,</span><span class="s">&quot;summed&quot;</span><span class="p">,</span><span class="s">&quot;correlated&quot;</span><span class="p">,</span><span class="s">&quot;uncorrelated_normal&quot;</span><span class="p">,</span><span class="s">&quot;uncorrelated_uniform&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_DataSetTypeList</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;regular season data - differences&quot;</span><span class="p">,</span><span class="s">&quot;regular season data - summed&quot;</span><span class="p">,</span><span class="s">&quot;correlated&quot;</span><span class="p">,</span><span class="s">&quot;uncorrelated_normal&quot;</span><span class="p">,</span><span class="s">&quot;uncorrelated_uniform&quot;</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">ChopOffLastList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inputData</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">inputData</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">prepareData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">keyString</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="c">#now prepare the data</span>
            <span class="n">tmpData</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prepareSeasonData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDict</span><span class="p">[</span><span class="n">keyString</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">[</span><span class="n">keyString</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ChopOffLastList</span><span class="p">(</span><span class="n">tmpData</span><span class="p">)</span>
            <span class="n">tmpData</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prepareSeasonData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDictSUM</span><span class="p">[</span><span class="n">keyString</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDictSUM</span><span class="p">[</span><span class="n">keyString</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ChopOffLastList</span><span class="p">(</span><span class="n">tmpData</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDictPostSeason</span><span class="o">==</span><span class="p">{}:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDictPostSeason</span><span class="p">[</span><span class="n">keyString</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prepareSeasonData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDictPostSeason</span><span class="p">[</span><span class="n">keyString</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;no postseason delta data found&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDictPostSeason</span><span class="o">==</span><span class="p">{}:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDictPostSeasonSUM</span><span class="p">[</span><span class="n">keyString</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prepareSeasonData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDictPostSeasonSUM</span><span class="p">[</span><span class="n">keyString</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;no postseason sum data found&quot;</span><span class="p">)</span>

        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;data preparation finished.&quot;</span><span class="p">)</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;we have found, read and processed the following datasets:&quot;</span><span class="p">)</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;following seasons for delta values: </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;following seasons for summed values: </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDictSUM</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>


    <span class="k">def</span> <span class="nf">returnDataForSeason</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">season</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">[</span><span class="n">season</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">prepareSeasonData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inputData</span><span class="p">):</span>

        <span class="c">#&quot;&quot;</span>
        <span class="c">#&quot;input: block of input data, in string format</span>
        <span class="c">#&quot;output: Nxk numpy output array of data, with the numerical part converted to numerical format</span>
        <span class="c">#&quot;&quot;</span>

        <span class="n">captionListe</span><span class="o">=</span><span class="n">inputData</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;input data contains the following k-datasets as columns:&quot;</span><span class="p">)</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">captionListe</span><span class="p">))</span>
        <span class="n">zeilenDatenListe</span><span class="o">=</span><span class="n">inputData</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">datenZeilenSpalten</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">zeilenDatenListe</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">p</span> <span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">datenZeilenSpalten</span> <span class="p">]</span>

    <span class="k">def</span> <span class="nf">enum</span><span class="p">(</span><span class="o">*</span><span class="n">sequential</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
        <span class="n">enums</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sequential</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequential</span><span class="p">))),</span> <span class="o">**</span><span class="n">named</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="s">&#39;Enum&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="n">enums</span><span class="p">)</span>


<div class="viewcode-block" id="prepareDataC.readInput"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.prepareDataC.readInput">[docs]</a>    <span class="k">def</span> <span class="nf">readInput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="p">,</span><span class="n">readUsingTK</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;read raw data from file and put it in dictionary&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seasonList</span><span class="p">:</span>
                    <span class="c">#now read the season and postseason data - differences and added values</span>
                    <span class="n">addOrDeltaList</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;_sum&quot;</span><span class="p">,</span><span class="s">&quot;_delta&quot;</span><span class="p">]</span>
                    <span class="n">regularOrPostseason</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;_regular&quot;</span><span class="p">,</span><span class="s">&quot;_postSeason&quot;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">addOrDelta</span> <span class="ow">in</span> <span class="n">addOrDeltaList</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">regularOrPlayoff</span> <span class="ow">in</span> <span class="n">regularOrPostseason</span><span class="p">:</span>
                            <span class="n">currentPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
                            <span class="n">filename</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">currentPath</span><span class="o">+</span><span class="s">&quot;/dataSetsNHL/dataFileNhl_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">season</span><span class="p">)</span><span class="o">+</span><span class="n">regularOrPlayoff</span><span class="o">+</span><span class="n">addOrDelta</span><span class="o">+</span><span class="s">&quot;.dat&quot;</span><span class="p">)</span>
                            <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;now read file&quot;</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
                                <span class="n">ToassertF</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="nb">str</span><span class="p">),</span><span class="n">critical</span><span class="p">,</span><span class="s">&quot;filepath &quot;</span><span class="p">,</span><span class="n">file_path</span><span class="p">,</span> <span class="s">&quot; is not a string!&quot;</span><span class="p">)</span>
                                <span class="n">season</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="c">#use the dictionary structure for convience and readability</span>
                                <span class="k">if</span> <span class="n">addOrDelta</span><span class="o">==</span><span class="s">&quot;_delta&quot;</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">regularOrPlayoff</span><span class="o">==</span><span class="s">&quot;_regular&quot;</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDict</span><span class="p">[</span><span class="n">season</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                                    <span class="k">elif</span> <span class="n">regularOrPlayoff</span><span class="o">==</span><span class="s">&quot;_postSeason&quot;</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDictPostSeason</span><span class="p">[</span><span class="n">season</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                                <span class="k">elif</span> <span class="n">addOrDelta</span><span class="o">==</span><span class="s">&quot;_sum&quot;</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">regularOrPlayoff</span><span class="o">==</span><span class="s">&quot;_regular&quot;</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDictSUM</span><span class="p">[</span><span class="n">season</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                                    <span class="k">elif</span> <span class="n">regularOrPlayoff</span><span class="o">==</span><span class="s">&quot;_postSeason&quot;</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDictPostSeasonSUM</span><span class="p">[</span><span class="n">season</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                                <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;file with filename &quot;</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="s">&quot; not found!&quot;</span><span class="p">)</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
                <span class="n">ToassertF</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="nb">str</span><span class="p">),</span><span class="n">critical</span><span class="p">,</span><span class="s">&quot;filepath &quot;</span><span class="p">,</span><span class="n">file_path</span><span class="p">,</span> <span class="s">&quot; is not a string!&quot;</span><span class="p">)</span>
                <span class="n">season</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ToassertF</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">season</span><span class="p">,</span><span class="nb">int</span><span class="p">),</span><span class="n">critical</span><span class="p">,</span><span class="s">&quot;season as extracted is &quot;</span><span class="p">,</span><span class="n">season</span><span class="p">,</span> <span class="s">&quot; and is not a number!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtInputDatenDict</span><span class="p">[</span><span class="n">season</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;could not read input data for season &quot;</span><span class="p">,</span> <span class="n">season</span>
</div>
    <span class="k">def</span> <span class="nf">GenerateGenericDistributedDataUnCorrelated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;generate unrelated normal distributed multivariate data&quot;</span><span class="p">)</span>
        <span class="n">unitCovDict</span><span class="o">=</span><span class="p">{}</span>
        <span class="c">#first write the delta data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedUnCorrelated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GenerateGenericDistributedDataHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">,</span><span class="n">unitCovDict</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="n">uniformDistribution</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c">#now write the sum file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedUnCorrelated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GenerateGenericDistributedDataHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDictSUM</span><span class="p">,</span><span class="n">unitCovDict</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="n">uniformDistribution</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GenerateGenericDistributedDataCorrelated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unitCovDict</span><span class="p">):</span>

        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;generate normal distributed multivariate data with predefined crosscorrelation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedCorrelated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GenerateGenericDistributedDataHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">,</span><span class="n">unitCovDict</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="n">uniformDistribution</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedCorrelated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GenerateGenericDistributedDataHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDictSUM</span><span class="p">,</span><span class="n">unitCovDict</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="n">uniformDistribution</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GenerateGenericDistributedDataUniform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;generate uniformly distributed multivariate data&quot;</span><span class="p">)</span>
        <span class="n">unitCovDict</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedUniformUncorrelated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GenerateGenericDistributedDataHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">,</span><span class="n">unitCovDict</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="n">uniformDistribution</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedUniformUncorrelated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GenerateGenericDistributedDataHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDictSUM</span><span class="p">,</span><span class="n">unitCovDict</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="n">uniformDistribution</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>



<div class="viewcode-block" id="prepareDataC.GenerateGenericDistributedDataHelper"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.prepareDataC.GenerateGenericDistributedDataHelper">[docs]</a>    <span class="k">def</span> <span class="nf">GenerateGenericDistributedDataHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">originalInputData</span><span class="p">,</span><span class="n">unitCovDictInput</span><span class="p">,</span><span class="n">uncorrelated</span><span class="p">,</span><span class="n">uniformDistribution</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        to generate correlated output data according to a multivariate normal distribution</span>
<span class="sd">        for testing reasons</span>
<span class="sd">        input:</span>
<span class="sd">            fullSeasonData a realistic NHL dataset - keep all games</span>
<span class="sd">                            just alter the results to correlate</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">captionList</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;ScoreDiff&quot;</span><span class="p">,</span><span class="s">&quot;shotsDiff&quot;</span><span class="p">,</span><span class="s">&quot;FaceoffDiff&quot;</span><span class="p">,</span>\
                     <span class="s">&quot;TakeawayDiff&quot;</span><span class="p">,</span><span class="s">&quot;GiveawaysDiff&quot;</span><span class="p">,</span><span class="s">&quot;PenaltyminutesDiff&quot;</span><span class="p">,</span>\
                     <span class="s">&quot;HitsDiff&quot;</span><span class="p">,</span><span class="s">&quot;powerplayGoalsDiff&quot;</span><span class="p">]</span>

        <span class="n">unitCovDict</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">cap1</span> <span class="ow">in</span> <span class="n">captionList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cap2</span> <span class="ow">in</span> <span class="n">captionList</span><span class="p">:</span>
                <span class="c">#initialize completely uncorrelated</span>
                <span class="n">unitCovDict</span><span class="p">[</span><span class="n">cap1</span><span class="p">,</span><span class="n">cap2</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>

        <span class="c">#then add some correlations - between 0 and 1:</span>

        <span class="k">if</span> <span class="n">unitCovDictInput</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;no cross correlations set between datasets&quot;</span><span class="p">)</span>
            <span class="c">#if no covariances are prefixed - do the standard ones</span>
            <span class="n">unitCovDict</span><span class="p">[</span><span class="s">&quot;ScoreDiff&quot;</span><span class="p">,</span><span class="s">&quot;shotsDiff&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.5</span>
            <span class="n">unitCovDict</span><span class="p">[</span><span class="s">&quot;FaceoffDiff&quot;</span><span class="p">,</span><span class="s">&quot;GiveawaysDiff&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.7</span>
            <span class="n">unitCovDict</span><span class="p">[</span><span class="s">&quot;HitsDiff&quot;</span><span class="p">,</span><span class="s">&quot;PenaltyminutesDiff&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.6</span>
            <span class="c">#6-8</span>
            <span class="n">unitCovDict</span><span class="p">[</span><span class="s">&quot;PenaltyminutesDiff&quot;</span><span class="p">,</span><span class="s">&quot;powerplayGoalsDiff&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">uncorrelated</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;generate uncorrelated data - independent normal distributions around a fixed mean and fixed variance&quot;</span><span class="p">)</span>

        <span class="c">#now loop over all the seasons</span>
        <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="n">originalInputData</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="n">wonYN</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">wonYN</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">originalInputData</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">ScoreDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">ScoreDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">originalInputData</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">shotsDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">ShDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">originalInputData</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">FaceoffDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">FaceoffDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">originalInputData</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">TakeawayDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">TakeawayDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">originalInputData</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">GiveawaysDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">GiveawaysDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">originalInputData</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">PenaltyminutesDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">PenaltyminutesDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">originalInputData</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">HitsDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">HitsDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">originalInputData</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">powerplayGoalsDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">powerplayGoalsDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">originalInputData</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>

            <span class="c">#now generate a multivariate distribution#</span>

            <span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ScoreDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">shotsDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">FaceoffDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">TakeawayDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">GiveawaysDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">PenaltyminutesDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">HitsDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">powerplayGoalsDiff</span><span class="p">)]</span>

            <span class="n">covii</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">ScoreDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">shotsDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">FaceoffDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">TakeawayDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">GiveawaysDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">PenaltyminutesDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">HitsDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">powerplayGoalsDiff</span><span class="p">)]</span>


            <span class="n">cov</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">mean</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">mean</span><span class="p">)])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean</span><span class="p">)):</span>
             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean</span><span class="p">)):</span>
                 <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">j</span><span class="p">:</span>
                    <span class="n">cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">covii</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                 <span class="k">else</span><span class="p">:</span>
                     <span class="c">#correlations between 0 and 1 in units of self correlation coefficients</span>
                    <span class="n">cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">covii</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">covii</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">unitCovDict</span><span class="p">[</span><span class="n">captionList</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">captionList</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>

            <span class="c">#mean = np.asarray([0, 0])</span>
            <span class="c">#cov = np.asarray([[100, 77], [0, 50]])</span>
            <span class="n">numberOfGeneratedGames</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">wonYN</span><span class="p">)</span>
            <span class="n">numberOfGeneratedCategories</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">captionList</span><span class="p">)</span>

            <span class="n">xout</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numberOfGeneratedCategories</span><span class="p">,</span><span class="n">numberOfGeneratedGames</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">uniformDistribution</span><span class="p">:</span>
                <span class="n">xoutSum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">numberOfGeneratedGames</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="n">xoutDelta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">numberOfGeneratedGames</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;now we generate uniform distributed data&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfGeneratedCategories</span><span class="p">):</span>
                    <span class="c">#if writeDeltaDataTrue==False:</span>
                    <span class="c">#    minimum=1</span>
                    <span class="c">#else:</span>
                    <span class="c">#    minimum=int(mean[i]-2*np.sqrt(cov[i,i]))</span>
                    <span class="n">maximum</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]))</span>
                    <span class="n">minimum</span><span class="o">=-</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">minimum</span><span class="p">,</span><span class="n">maximum</span><span class="p">)</span>
                    <span class="n">maximum</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span>
                    <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;minimum for distribution set to &quot;</span><span class="p">,</span><span class="n">minimum</span><span class="p">,</span><span class="s">&quot; maximum is &quot;</span><span class="p">,</span><span class="n">maximum</span><span class="p">,</span><span class="s">&quot; with mean &quot;</span><span class="p">,</span><span class="n">mean</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">maximum</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,:]))</span>


            <span class="c">#now transform variables to realistic values</span>

            <span class="c">#first transform all the values to int</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">xout</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">xout</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                    <span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                    <span class="c">#cut off maximal values at an arbitrary value of +-20</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">20</span><span class="p">:</span>
                        <span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="mi">19</span>


            <span class="c">#for summed values - all entries have to be positive</span>
            <span class="c">#if writeDeltaDataTrue==False:</span>
            <span class="c">#    for i in range(min(xout.shape)):</span>
            <span class="c">#        for j in range(max(xout.shape)):</span>
            <span class="c">#            if xout[i,j]&lt;0:</span>
            <span class="c">#                xout[i,j]=-xout[i,j]</span>


            <span class="n">wonYNList</span><span class="o">=</span><span class="p">[]</span>
            <span class="c">#if home team scores more goals it has won</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">xout</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                <span class="n">scoreDiff</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">scoreDiff</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">:</span>
                    <span class="c">#0 is category of wins</span>
                    <span class="n">wonYNList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wonYNList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


            <span class="c">#now transform the data back into the input array</span>
            <span class="c">#fullSeasonArray=np.asarray(fullSeasonData)</span>

            <span class="n">generatedDataDict</span><span class="o">=</span><span class="p">{}</span>
            <span class="c">#for seasonkey in originalInputData.keys():</span>

                <span class="c">#if uncorrelated==True and uniformDistribution==False:</span>
                <span class="c">#elif uncorrelated==False and uniformDistribution==False:</span>
                <span class="c">#elif uniformDistribution==True:</span>

            <span class="c">#the first five kategories</span>
            <span class="c">#&quot;ID&quot;,&quot;season&quot;,&quot;date&quot;,&quot;homeTeam&quot;,&quot;awayTeam&quot;</span>
            <span class="c"># are not altered</span>
            <span class="n">writeDeltaDataTrue</span><span class="o">=</span><span class="bp">False</span>
            <span class="n">actualGameType</span><span class="o">=</span><span class="n">GameType</span><span class="o">.</span><span class="n">Regular</span>
            <span class="c">#get the filename for the generated data</span>
            <span class="c">#fileName=self.assembleGeneratedFileName(season,actualGameType,writeDeltaDataTrue,uncorrelated,uniformDistribution)</span>
            <span class="c">#first overwrite existing files with same filename#</span>
            <span class="c">#f=open(fileName,&quot;w+&quot;)</span>
            <span class="c">#f.write(&quot;\n&quot;)</span>
            <span class="c">#f.close()</span>

            <span class="n">generatedDataDict</span><span class="p">[</span><span class="n">season</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">gameID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfGeneratedGames</span><span class="p">):</span>
                <span class="c">#we make a shallow copy of the orginial data - replacing only the generated data</span>
                <span class="n">rowToAppend</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">originalInputData</span><span class="p">[</span><span class="n">season</span><span class="p">][</span><span class="n">gameID</span><span class="p">])</span>
                <span class="c">#but now alter entries 5 to last one</span>
                <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">wonYN</span><span class="p">]</span><span class="o">=</span><span class="n">wonYNList</span><span class="p">[</span><span class="n">gameID</span><span class="p">]</span>
                <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">ScoreDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">ShDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">FaceoffDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">TakeawayDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">GiveawaysDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">PenaltyminutesDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">HitsDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">powerplayGoalsDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>

                <span class="c">#now append the data again</span>
                <span class="n">generatedDataDict</span><span class="p">[</span><span class="n">season</span><span class="p">]</span><span class="o">=</span><span class="n">generatedDataDict</span><span class="p">[</span><span class="n">season</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">rowToAppend</span><span class="p">]</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span><span class="s">&quot;a+&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="c">#ID season Date homeTeam awayTeam WonYN ScoreDiff ShDiff FacoffDiff TakeawayDiff GiveawaysDiff PenaltyminutesDiff HitsDiff powerPlayGoals Attendance</span>

                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">ID</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">season</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">date</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">awayTeam</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">wonYN</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">ScoreDiff</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">ShDiff</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">FaceoffDiff</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">TakeawayDiff</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">GiveawaysDiff</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">PenaltyminutesDiff</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">HitsDiff</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">powerplayGoalsDiff</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">Attendance</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>\
                            <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">ID</span><span class="p">]))</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;I/O error({0}): {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errno</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">strerror</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;Could not convert data to an string.&quot;</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">raise</span>


        <span class="k">return</span> <span class="n">generatedDataDict</span>

</div>
<div class="viewcode-block" id="prepareDataC.assembleGeneratedFileName"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.prepareDataC.assembleGeneratedFileName">[docs]</a>    <span class="k">def</span> <span class="nf">assembleGeneratedFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thisSeason</span><span class="p">,</span><span class="n">actualGameType</span><span class="p">,</span><span class="n">plusMinus</span><span class="p">,</span><span class="n">uncorrelated</span><span class="p">,</span><span class="n">uniformDistribution</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        assemble name of output file</span>
<span class="sd">        input:</span>
<span class="sd">        season: 4 digit number specifying season e.g. 2010</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">actualGameType</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span><span class="c">#self.MinerC._gameTypeList[0]:</span>
            <span class="n">addString</span><span class="o">=</span><span class="s">&quot;_regular&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">addString</span><span class="o">=</span><span class="s">&quot;_postSeason&quot;</span>

        <span class="k">if</span> <span class="n">uncorrelated</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">uniformDistribution</span><span class="p">:</span>
            <span class="n">addStringCorrelationMethod</span><span class="o">=</span><span class="s">&quot;_uniform&quot;</span>
        <span class="k">elif</span>  <span class="n">uncorrelated</span> <span class="ow">and</span> <span class="n">uniformDistribution</span><span class="p">:</span>
            <span class="n">addStringCorrelationMethod</span><span class="o">=</span><span class="s">&quot;_normal_uncorrelated&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">addStringCorrelationMethod</span><span class="o">=</span><span class="s">&quot;_normal_correlated&quot;</span>

        <span class="k">if</span> <span class="n">plusMinus</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">fileName</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">MinerC</span><span class="o">.</span><span class="n">_fileNamePrefix</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">thisSeason</span><span class="p">),</span><span class="n">addString</span><span class="p">,</span><span class="n">addStringCorrelationMethod</span><span class="p">,</span><span class="s">&quot;_delta&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">MinerC</span><span class="o">.</span><span class="n">_fileNamePostfix</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fileName</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">MinerC</span><span class="o">.</span><span class="n">_fileNamePrefix</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">thisSeason</span><span class="p">),</span><span class="n">addString</span><span class="p">,</span><span class="n">addStringCorrelationMethod</span><span class="p">,</span><span class="s">&quot;_sum&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">MinerC</span><span class="o">.</span><span class="n">_fileNamePostfix</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">fileName</span>
</div>
    <span class="k">def</span> <span class="nf">GenerateGenericDataUnCorrelated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;generate unrelated normal distributed multivariate data&quot;</span><span class="p">)</span>
        <span class="n">unitCovDict</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedUnCorrelated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GenerateGenericDataCorrelatedHelper</span><span class="p">(</span><span class="n">unitCovDict</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GenerateGenericDataCorrelated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unitCovDict</span><span class="p">):</span>

        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;generate normal distributed multivariate data with predefined crosscorrelation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedCorrelated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GenerateGenericDataCorrelatedHelper</span><span class="p">(</span><span class="n">unitCovDict</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GenerateGenericDataUniform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;generate uniformly distributed multivariate data&quot;</span><span class="p">)</span>
        <span class="n">unitCovDict</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedUniformUncorrelated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GenerateGenericDataCorrelatedHelper</span><span class="p">(</span><span class="n">unitCovDict</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="n">uniformDistribution</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<div class="viewcode-block" id="prepareDataC.GenerateGenericDataCorrelatedHelper"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.prepareDataC.GenerateGenericDataCorrelatedHelper">[docs]</a>    <span class="k">def</span> <span class="nf">GenerateGenericDataCorrelatedHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unitCovDictInput</span><span class="p">,</span><span class="n">uncorrelated</span><span class="p">,</span><span class="n">uniformDistribution</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        to generate correlated output data according to a multivariate normal distribution</span>
<span class="sd">        for testing reasons</span>
<span class="sd">        input:</span>
<span class="sd">            fullSeasonData a realistic NHL dataset - keep all games</span>
<span class="sd">                            just alter the results to correlate</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c">#tmpPlaceHolder=np.zeros(NoGames)</span>
        <span class="c">#fullGenericDataSet=np.array(fullSeasonData)</span>

        <span class="c">#for id in NoGames:</span>
        <span class="c">#    for team in teams:</span>
        <span class="c">#            x=0</span>

        <span class="n">captionList</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;ScoreDiff&quot;</span><span class="p">,</span><span class="s">&quot;shotsDiff&quot;</span><span class="p">,</span><span class="s">&quot;FaceoffDiff&quot;</span><span class="p">,</span>\
                     <span class="s">&quot;TakeawayDiff&quot;</span><span class="p">,</span><span class="s">&quot;GiveawaysDiff&quot;</span><span class="p">,</span><span class="s">&quot;PenaltyminutesDiff&quot;</span><span class="p">,</span>\
                     <span class="s">&quot;HitsDiff&quot;</span><span class="p">,</span><span class="s">&quot;powerplayGoalsDiff&quot;</span><span class="p">]</span>


        <span class="n">unitCovDict</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">cap1</span> <span class="ow">in</span> <span class="n">captionList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cap2</span> <span class="ow">in</span> <span class="n">captionList</span><span class="p">:</span>
                <span class="c">#initialize completely uncorrelated</span>
                <span class="n">unitCovDict</span><span class="p">[</span><span class="n">cap1</span><span class="p">,</span><span class="n">cap2</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>

        <span class="c">#then add some correlations - between 0 and 1:</span>

        <span class="k">if</span> <span class="n">unitCovDictInput</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;no cross correlations set between datasets&quot;</span><span class="p">)</span>
            <span class="c">#if no covariances are prefixed - do the standard ones</span>
            <span class="n">unitCovDict</span><span class="p">[</span><span class="s">&quot;ScoreDiff&quot;</span><span class="p">,</span><span class="s">&quot;shotsDiff&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.5</span>
            <span class="n">unitCovDict</span><span class="p">[</span><span class="s">&quot;FaceoffDiff&quot;</span><span class="p">,</span><span class="s">&quot;GiveawaysDiff&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.7</span>
            <span class="n">unitCovDict</span><span class="p">[</span><span class="s">&quot;HitsDiff&quot;</span><span class="p">,</span><span class="s">&quot;PenaltyminutesDiff&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.6</span>
            <span class="c">#6-8</span>
            <span class="n">unitCovDict</span><span class="p">[</span><span class="s">&quot;PenaltyminutesDiff&quot;</span><span class="p">,</span><span class="s">&quot;powerplayGoalsDiff&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">uncorrelated</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;generate uncorrelated data - independent normal distributions around a fixed mean and fixed variance&quot;</span><span class="p">)</span>

        <span class="c">#now loop over all the seasons</span>
        <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="n">wonYN</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">wonYN</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">ScoreDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">ScoreDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">shotsDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">ShDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">FaceoffDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">FaceoffDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">TakeawayDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">TakeawayDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">GiveawaysDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">GiveawaysDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">PenaltyminutesDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">PenaltyminutesDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">HitsDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">HitsDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>
            <span class="n">powerplayGoalsDiff</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">powerplayGoalsDiff</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">[</span><span class="n">season</span><span class="p">]]</span>

            <span class="c">#now generate a multivariate distribution#</span>

            <span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ScoreDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">shotsDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">FaceoffDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">TakeawayDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">GiveawaysDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">PenaltyminutesDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">HitsDiff</span><span class="p">)]</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">powerplayGoalsDiff</span><span class="p">)]</span>

            <span class="n">covii</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">ScoreDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">shotsDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">FaceoffDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">TakeawayDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">GiveawaysDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">PenaltyminutesDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">HitsDiff</span><span class="p">)]</span>
            <span class="n">covii</span><span class="o">=</span><span class="n">covii</span><span class="o">+</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">powerplayGoalsDiff</span><span class="p">)]</span>


            <span class="n">cov</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">mean</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">mean</span><span class="p">)])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean</span><span class="p">)):</span>
             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean</span><span class="p">)):</span>
                 <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">j</span><span class="p">:</span>
                    <span class="n">cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">covii</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                 <span class="k">else</span><span class="p">:</span>
                     <span class="c">#correlations between 0 and 1 in units of self correlation coefficients</span>
                    <span class="n">cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">covii</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">covii</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">unitCovDict</span><span class="p">[</span><span class="n">captionList</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">captionList</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>


            <span class="c">#mean = np.asarray([0, 0])</span>
            <span class="c">#cov = np.asarray([[100, 77], [0, 50]])</span>
            <span class="n">numberOfGeneratedGames</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">wonYN</span><span class="p">)</span>
            <span class="n">numberOfGeneratedCategories</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">captionList</span><span class="p">)</span>


            <span class="n">xout</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numberOfGeneratedCategories</span><span class="p">,</span><span class="n">numberOfGeneratedGames</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">uniformDistribution</span><span class="p">:</span>
                <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">numberOfGeneratedGames</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;now we generate uniform distributed data&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfGeneratedCategories</span><span class="p">):</span>
                    <span class="n">minimum</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]))</span>
                    <span class="n">maximum</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]))</span>
                    <span class="n">minimum</span><span class="o">=-</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">minimum</span><span class="p">,</span><span class="n">maximum</span><span class="p">)</span>
                    <span class="n">maximum</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span>
                    <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;minimum for distribution set to &quot;</span><span class="p">,</span><span class="n">minimum</span><span class="p">,</span><span class="s">&quot; maximum is &quot;</span><span class="p">,</span><span class="n">maximum</span><span class="p">,</span><span class="s">&quot; with mean &quot;</span><span class="p">,</span><span class="n">mean</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">maximum</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,:]))</span>


            <span class="c">#now transform variables to realistic values</span>

            <span class="c">#first transform all the values to int</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">xout</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">xout</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                    <span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                    <span class="c">#cut off maximal values at an arbitrary value of +-20</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">20</span><span class="p">:</span>
                        <span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="mi">19</span>

            <span class="n">wonYNList</span><span class="o">=</span><span class="p">[]</span>
            <span class="c">#if home team scores more goals it has won</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">xout</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                <span class="n">scoreDiff</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">scoreDiff</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">:</span>
                    <span class="c">#0 is category of wins</span>
                    <span class="n">wonYNList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wonYNList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


            <span class="c">#now transform the data back into the input array</span>
            <span class="c">#fullSeasonArray=np.asarray(fullSeasonData)</span>

            <span class="n">generatedDataDict</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">seasonkey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

                <span class="c">#if uncorrelated==True and uniformDistribution==False:</span>
                <span class="c">#elif uncorrelated==False and uniformDistribution==False:</span>
                <span class="c">#elif uniformDistribution==True:</span>



            <span class="c">#the first five kategories</span>
            <span class="c">#&quot;ID&quot;,&quot;season&quot;,&quot;date&quot;,&quot;homeTeam&quot;,&quot;awayTeam&quot;</span>
            <span class="c"># are not altered</span>
                <span class="n">generatedDataDict</span><span class="p">[</span><span class="n">seasonkey</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">gameID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfGeneratedGames</span><span class="p">):</span>
                    <span class="c">#we make a shallow copy</span>
                    <span class="n">rowToAppend</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gesamtDatenDict</span><span class="p">[</span><span class="n">season</span><span class="p">][</span><span class="n">gameID</span><span class="p">])</span>
                    <span class="c">#but now alter entries 5 to last one</span>
                    <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">wonYN</span><span class="p">]</span><span class="o">=</span><span class="n">wonYNList</span><span class="p">[</span><span class="n">gameID</span><span class="p">]</span>
                    <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">ScoreDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                    <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">ShDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                    <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">FaceoffDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                    <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">TakeawayDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                    <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">GiveawaysDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                    <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">PenaltyminutesDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                    <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">HitsDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>
                    <span class="n">rowToAppend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_EN</span><span class="o">.</span><span class="n">powerplayGoalsDiff</span><span class="p">]</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="n">gameID</span><span class="p">]</span>

                    <span class="n">generatedDataDict</span><span class="p">[</span><span class="n">seasonkey</span><span class="p">]</span><span class="o">=</span><span class="n">generatedDataDict</span><span class="p">[</span><span class="n">seasonkey</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">rowToAppend</span><span class="p">]</span>

                <span class="c">#for kategoryID in range(numberOfGeneratedCategories):</span>
                <span class="c">#    #now add all the data into the final array</span>
                <span class="c">#    generatedDataDict[seasonkey]=generatedDataDict[seasonkey]+xout[kategoryID,:]</span>


            <span class="k">return</span> <span class="n">generatedDataDict</span>

            <span class="nb">id</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">xout</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">xout</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">1</span> \
                    <span class="ow">or</span> <span class="n">i</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">2</span> \
                    <span class="ow">or</span> <span class="n">i</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">5</span> \
                    <span class="ow">or</span> <span class="n">i</span><span class="o">==</span><span class="mi">7</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">6</span> \
                    <span class="ow">or</span> <span class="n">i</span><span class="o">==</span><span class="mi">6</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">8</span><span class="p">:</span>
                        <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">Label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">captionList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;-&quot;</span><span class="o">+</span><span class="n">captionList</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">xout</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nb">id</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">Label</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                        <span class="c">#axes = plt.gca()</span>
                        <span class="c">#axes.set_ylim([-0.5,1.5])</span>


            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="c">#class names start uppercase, end with upper C</span>
</div></div>
<div class="viewcode-block" id="AnalysisC"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.AnalysisC">[docs]</a><span class="k">class</span> <span class="nc">AnalysisC</span><span class="p">():</span><span class="c">#prepareDataC):</span>
    <span class="sd">&quot;&quot;&quot;main analysis class - fetches data and contains&quot;&quot;&quot;</span>

    <span class="c">#this is a global variable - is increased for every instance for every derived class for every plot</span>
    <span class="n">__globalFigureID</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">__gesamtDatenDict</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">__gesamtDatenGeneratedUniformUncorrelated</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">__gesamtDatenGeneratedUnCorrelated</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">__gesamtDatenGeneratedCorrelated</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">__globaltestvar</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">__EN</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">__ENList</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">__DataSetTypeList</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">__TeamList</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">prepareDataC</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ENList</span><span class="o">=</span><span class="n">prepareDataC</span><span class="o">.</span><span class="n">_ENList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">=</span><span class="n">prepareDataC</span><span class="o">.</span><span class="n">_EN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__DataSetType</span><span class="o">=</span><span class="n">prepareDataC</span><span class="o">.</span><span class="n">_DataSetType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__DataSetTypeList</span><span class="o">=</span><span class="n">prepareDataC</span><span class="o">.</span><span class="n">_DataSetTypeList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__globaltestvar</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gesamtDatenDict</span><span class="o">=</span><span class="n">prepareDataC</span><span class="o">.</span><span class="n">_gesamtDatenDict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gesamtDatenDictSUM</span><span class="o">=</span><span class="n">prepareDataC</span><span class="o">.</span><span class="n">_gesamtDatenDictSUM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gesamtDatenGeneratedUniformUncorrelated</span><span class="o">=</span><span class="n">prepareDataC</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedUniformUncorrelated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gesamtDatenGeneratedUnCorrelated</span><span class="o">=</span><span class="n">prepareDataC</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedUnCorrelated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gesamtDatenGeneratedCorrelated</span><span class="o">=</span><span class="n">prepareDataC</span><span class="o">.</span><span class="n">_gesamtDatenGeneratedCorrelated</span>

        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;gesamtDatenDict has the following keys:&quot;</span><span class="p">)</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">__gesamtDatenDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c">#pick out the first season data and fetch all the teams names for later reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_TeamList</span><span class="o">=</span><span class="nb">set</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gesamtDatenDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__gesamtDatenDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataType</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;AnalysisC class instance successfully initialized!&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="AnalysisC.GetSeasonList"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.AnalysisC.GetSeasonList">[docs]</a>    <span class="k">def</span> <span class="nf">GetSeasonList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dataID</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return list of seasons for imported game data&quot;&quot;&quot;</span>
        <span class="n">dataDict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Dataselector</span><span class="p">(</span><span class="n">dataID</span><span class="p">)</span>
        <span class="c">#the season list is just a query on the keys of the dict</span>
        <span class="k">return</span> <span class="n">dataDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="AnalysisC.GetTeamList"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.AnalysisC.GetTeamList">[docs]</a>    <span class="k">def</span> <span class="nf">GetTeamList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get list of teams for imported game data&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TeamList</span>
</div>
<div class="viewcode-block" id="AnalysisC.GetEN"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.AnalysisC.GetEN">[docs]</a>    <span class="k">def</span> <span class="nf">GetEN</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return the enumeration object containing the data categories of imported game data&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__EN</span>
</div>
<div class="viewcode-block" id="AnalysisC.GetENList"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.AnalysisC.GetENList">[docs]</a>    <span class="k">def</span> <span class="nf">GetENList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return the enumeration object containing the data categories of imported game data&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ENList</span>
</div>
<div class="viewcode-block" id="AnalysisC.GetDataSetType"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.AnalysisC.GetDataSetType">[docs]</a>    <span class="k">def</span> <span class="nf">GetDataSetType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return the dataset type: summed, delta or generated data&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__DataSetType</span>
</div>
    <span class="k">def</span> <span class="nf">GetDataSetTypeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__DataSetTypeList</span>

<div class="viewcode-block" id="AnalysisC.Dataselector"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.AnalysisC.Dataselector">[docs]</a>    <span class="k">def</span> <span class="nf">Dataselector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dataID</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return the dataset among the bunch of delta, summed and generated datasets&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dataID</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">__DataSetType</span><span class="o">.</span><span class="n">delta</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetGesamtDaten</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dataID</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">__DataSetType</span><span class="o">.</span><span class="n">summed</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetGesamtDatenSUM</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">dataID</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">__DataSetType</span><span class="o">.</span><span class="n">correlated</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetGesamtDatenGenericCorrNormal</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">dataID</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">__DataSetType</span><span class="o">.</span><span class="n">uncorrelated_normal</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetGesamtDatenGenericUncorrNormal</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">dataID</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">__DataSetType</span><span class="o">.</span><span class="n">uncorrelated_uniform</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetGesamtDatenGenericUncorrUniform</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ToassertF</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="n">critical</span><span class="p">,</span><span class="s">&quot;dataselector found no valid data ID - quit&quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">GetGesamtDaten</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gesamtDatenDict</span>

    <span class="k">def</span> <span class="nf">GetGesamtDatenSUM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gesamtDatenDictSUM</span>

    <span class="k">def</span> <span class="nf">GetGesamtDatenGenericUncorrNormal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gesamtDatenGeneratedUnCorrelated</span>

    <span class="k">def</span> <span class="nf">GetGesamtDatenGenericUncorrUniform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gesamtDatenGeneratedUniformUncorrelated</span>

    <span class="k">def</span> <span class="nf">GetGesamtDatenGenericCorrNormal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gesamtDatenGeneratedCorrelated</span>

    <span class="k">def</span> <span class="nf">GetAndIncreaseGlobalFigureID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__globalFigureID</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__globalFigureID</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__globalFigureID</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">PreparePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetAndIncreaseGlobalFigureID</span><span class="p">())</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nb">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">PlotAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">FetchDataAndAverageOverOneGameday</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seasonData</span><span class="p">,</span><span class="n">dataKategory</span><span class="p">):</span>

        <span class="n">tmpList</span><span class="o">=</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="n">dataKategory</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">date</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">seasonData</span><span class="p">]</span>
        <span class="n">oldDate</span><span class="o">=-</span><span class="mi">1</span>
        <span class="n">zaehler</span><span class="o">=</span><span class="mi">1</span>
        <span class="nb">id</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">avg</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">listOfGameDayAveragedValues</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="nb">tuple</span> <span class="ow">in</span> <span class="n">tmpList</span><span class="p">:</span>
            <span class="n">val</span><span class="o">=</span><span class="nb">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">newDate</span><span class="o">=</span><span class="nb">tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c">#average over all games in a day</span>
            <span class="c">#in the first step do it differently</span>
            <span class="k">if</span> <span class="nb">id</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">avg</span><span class="o">=</span><span class="n">avg</span><span class="o">+</span><span class="n">val</span>
                <span class="n">zaehler</span><span class="o">=</span><span class="n">zaehler</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">newDate</span><span class="o">==</span><span class="n">oldDate</span><span class="p">:</span>
                    <span class="c">#now we add values</span>
                    <span class="n">avg</span><span class="o">=</span><span class="n">avg</span><span class="o">+</span><span class="n">val</span>
                    <span class="n">zaehler</span><span class="o">=</span><span class="n">zaehler</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">#we do nothing but reset avg and the counter and add the previously calculated value to the list</span>
                    <span class="n">avg</span><span class="o">=</span><span class="n">avg</span><span class="o">/</span><span class="n">zaehler</span>
                    <span class="n">listOfGameDayAveragedValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span>
                    <span class="n">avg</span><span class="o">=</span><span class="n">val</span>
                    <span class="n">zaehler</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">oldDate</span><span class="o">=</span><span class="n">newDate</span>
            <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="o">+</span><span class="mi">1</span>

        <span class="k">return</span> <span class="n">listOfGameDayAveragedValues</span>
</div>
<div class="viewcode-block" id="NeuralNetworkAnalysisC"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.NeuralNetworkAnalysisC">[docs]</a><span class="k">class</span> <span class="nc">NeuralNetworkAnalysisC</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;not really derived from AnalysisC, just lends some methods and shared data for all methods&quot;&quot;&quot;</span>

    <span class="n">__LARGENEGATIVE</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">AnalysisC</span><span class="p">):</span><span class="c">#prepareDataC):</span>
        <span class="c">#we do not instantiate the AnalysisC class, but just share some knowledge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">=</span><span class="n">AnalysisC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetEN</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ENList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetENList</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analyzedSeasonList</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataType</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seasonList</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__teamList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetTeamList</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_NOHIDDENLAYERSMIN</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_NOHIDDENLAYERSMAX</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_NONEURONSHIDDENLAYER_MULTIPLE_OF_INPUT_NEURONS</span><span class="o">=</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_allHomeGamesDatesTupleT1</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allHomeGamesDatesTupleT2</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outData</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_homeGameT1</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_homeGameT2</span><span class="o">=</span><span class="s">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_outNNEstimateList</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outNNActual</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errNNPrct</span><span class="o">=</span><span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__LARGENEGATIVE</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_NN</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_superVData</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trndata</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tstdata</span><span class="o">=</span><span class="s">&quot;&quot;</span>

<span class="c">#    def ExecuteNN(self):</span>
<span class="c">#        [inputDatenNeuralNetwork,targetDatenNeuralNetwork]=self.SetupNNDataMatchup(gesamtDatenDict,&quot;NYI&quot;,&quot;NYR&quot;)</span>
<span class="c">#        self.ExecuteNeuralNetwork(inputDatenNeuralNetwork,targetDatenNeuralNetwork)</span>

<div class="viewcode-block" id="NeuralNetworkAnalysisC.SetupNeuralNetwork"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.NeuralNetworkAnalysisC.SetupNeuralNetwork">[docs]</a>    <span class="k">def</span> <span class="nf">SetupNeuralNetwork</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">NhiddenLayers</span><span class="p">,</span><span class="n">NoHiddenNeuronsInNoInputLayers</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; setup the feed forward neural network</span>
<span class="sd">        :param NhiddenLayers: number of hidden layers in the neural network</span>
<span class="sd">        :param NoHiddenNeuronsInNoInputLayers:  number of neurons in a hidden layer</span>
<span class="sd">        :return: nothing, sets an internal field directing to the neural network</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c">#the number of input layers is the number of columns of the input data</span>
        <span class="n">NInputLayerNeurons</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="c">#we experiment around with a fixed ratio of hidden to input layer neurons</span>
        <span class="n">NHiddenLayerNeurons</span><span class="o">=</span><span class="n">NoHiddenNeuronsInNoInputLayers</span><span class="o">*</span><span class="n">NInputLayerNeurons</span>
        <span class="c">#we only map on the outcome - win or lose</span>
        <span class="n">NOutputLayerNeurons</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_outData</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">pybrain.structure</span> <span class="kn">import</span> <span class="n">FeedForwardNetwork</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nn</span> <span class="o">=</span> <span class="n">FeedForwardNetwork</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">pybrain.structure</span> <span class="kn">import</span> <span class="n">LinearLayer</span><span class="p">,</span> <span class="n">SigmoidLayer</span>
        <span class="n">inLayer</span> <span class="o">=</span> <span class="n">LinearLayer</span><span class="p">(</span><span class="n">NInputLayerNeurons</span><span class="p">)</span>
        <span class="n">hiddenLayerList</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NhiddenLayers</span><span class="p">):</span>
            <span class="n">hiddenLayerList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SigmoidLayer</span><span class="p">(</span><span class="n">NHiddenLayerNeurons</span><span class="p">))</span>
        <span class="n">outLayer</span> <span class="o">=</span> <span class="n">LinearLayer</span><span class="p">(</span><span class="n">NOutputLayerNeurons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">addInputModule</span><span class="p">(</span><span class="n">inLayer</span><span class="p">)</span>
        <span class="c">#now we add all the hidden layers</span>
        <span class="k">for</span> <span class="n">hiddenLayerElement</span> <span class="ow">in</span> <span class="n">hiddenLayerList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">hiddenLayerElement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">addOutputModule</span><span class="p">(</span><span class="n">outLayer</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">pybrain.structure</span> <span class="kn">import</span> <span class="n">FullConnection</span>
        <span class="n">in_to_hidden</span> <span class="o">=</span> <span class="n">FullConnection</span><span class="p">(</span><span class="n">inLayer</span><span class="p">,</span> <span class="n">hiddenLayerList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c">#connect all the hidden layers among each other - only full connections here</span>
        <span class="n">List_hidden1_to_hidden2</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hiddenLayerList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">List_hidden1_to_hidden2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FullConnection</span><span class="p">(</span><span class="n">hiddenLayerList</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">hiddenLayerList</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="n">hidden_to_out</span> <span class="o">=</span> <span class="n">FullConnection</span><span class="p">(</span><span class="n">hiddenLayerList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">outLayer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">addConnection</span><span class="p">(</span><span class="n">in_to_hidden</span><span class="p">)</span>
        <span class="c">#add all the hidden layers</span>
        <span class="k">for</span> <span class="n">hidden_to_hidden_conn</span> <span class="ow">in</span> <span class="n">List_hidden1_to_hidden2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">addConnection</span><span class="p">(</span><span class="n">hidden_to_hidden_conn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">addConnection</span><span class="p">(</span><span class="n">hidden_to_out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">sortModules</span><span class="p">()</span>

        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Finished setup of a feed forward neural network with &quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">hiddenLayerList</span><span class="p">),</span><span class="s">&quot; hidden layers and &quot;</span><span class="p">,</span><span class="n">NHiddenLayerNeurons</span><span class="p">,</span><span class="s">&quot; neurons in the hidden layers.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NeuralNetworkAnalysisC.PrepareNNInputData"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.NeuralNetworkAnalysisC.PrepareNNInputData">[docs]</a>    <span class="k">def</span> <span class="nf">PrepareNNInputData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">splitFactorTrainingTest</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        split input data into training and testing set</span>
<span class="sd">        :param splitFactorTrainingTest: ratio of splitting into training to testing dataset</span>
<span class="sd">        :return nothing, writes neural network input data fields internally into array</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ToassertF</span><span class="p">((</span><span class="mf">0.1</span><span class="o">&lt;=</span><span class="n">splitFactorTrainingTest</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">splitFactorTrainingTest</span><span class="o">&lt;=</span><span class="mf">0.8</span><span class="p">),</span><span class="n">critical</span><span class="p">,</span><span class="s">&quot;in PrepareNNInputData set splitFactorTrainingTest between 0.25 and 0.75&quot;</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">pybrain.datasets</span>  <span class="kn">import</span> <span class="n">SupervisedDataSet</span>

        <span class="n">inputSize</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">outputSize</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_outData</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_superVData</span><span class="o">=</span><span class="n">SupervisedDataSet</span><span class="p">(</span><span class="n">inputSize</span><span class="p">,</span><span class="n">outputSize</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">inpElement</span><span class="p">,</span><span class="n">outElement</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_outData</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_superVData</span><span class="o">.</span><span class="n">addSample</span><span class="p">(</span><span class="n">inpElement</span><span class="p">,</span><span class="n">outElement</span><span class="p">)</span>

        <span class="c">#we use first 75% for training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tstdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_superVData</span><span class="o">.</span><span class="n">splitWithProportion</span><span class="p">(</span><span class="n">splitFactorTrainingTest</span><span class="p">)</span>
        <span class="c">#trndata._convertToOneOfMany( )</span>
        <span class="c">#tstdata._convertToOneOfMany( )</span>

        <span class="n">ToassertF</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trndata</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span><span class="n">critical</span><span class="p">,</span><span class="s">&quot;PrepareNNInputData: length of training dataset has to be greater 0! - length of input dataset is&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="p">),</span><span class="s">&quot; splitting factor is &quot;</span><span class="p">,</span><span class="n">splitFactorTrainingTest</span><span class="p">)</span>

        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Training data prepared: &quot;</span><span class="p">)</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Number of training patterns: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trndata</span><span class="p">))</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Number of testing datasets: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tstdata</span><span class="p">))</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Input and output dimensions: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trndata</span><span class="o">.</span><span class="n">indim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trndata</span><span class="o">.</span><span class="n">outdim</span><span class="p">)</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;First sample:&quot;</span><span class="p">)</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Input data: &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_trndata</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Output data: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trndata</span><span class="p">[</span><span class="s">&#39;target&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="NeuralNetworkAnalysisC.RunNeuralNetwork"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.NeuralNetworkAnalysisC.RunNeuralNetwork">[docs]</a>    <span class="k">def</span> <span class="nf">RunNeuralNetwork</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        setup the neural network</span>
<span class="sd">        input:</span>
<span class="sd">            inputData:</span>
<span class="sd">                    pre-formatted data, with d-columns - we initialize as many input neurons as data columns</span>
<span class="sd">            NhiddenLayers:</span>
<span class="sd">                    number of hidden (in between) layers of the neural network</span>
<span class="sd">            NoHiddenNeuronsInNoInputLayers:</span>
<span class="sd">                    number of neurons in hidden layer as multiple of input neurons</span>
<span class="sd">        output:</span>
<span class="sd">            estimationOut</span>
<span class="sd">                    list of estimated outputs</span>
<span class="sd">            actualOut</span>
<span class="sd">                    list of actual outputs as given in input</span>
<span class="sd">            errorPercent</span>
<span class="sd">                    error of estimation in %</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">pybrain.supervised.trainers</span> <span class="kn">import</span> <span class="n">BackpropTrainer</span>

        <span class="n">trainer</span> <span class="o">=</span> <span class="n">BackpropTrainer</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_trndata</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">weightdecay</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="c">#trainer.setData(superVData)</span>

        <span class="kn">from</span> <span class="nn">pybrain.tools.validation</span> <span class="kn">import</span> <span class="n">ModuleValidator</span>
        <span class="c">#from pybrain.tools.validation   import NNregression</span>

        <span class="c">#contains methods to calculate error between predicted and target values</span>
        <span class="n">MV</span><span class="o">=</span><span class="n">ModuleValidator</span><span class="p">()</span>

        <span class="c">#NNreg=NNregression(superVData)</span>
        <span class="c">#for i in range(2):</span>
        <span class="c">#    trainer.trainEpochs( 300 )</span>
            <span class="c">#now we check the results visually</span>
            <span class="c">#for (elemI,elemO) in zip(inputData[-5:],outData[-5:]):</span>
            <span class="c">#    print nn.activate(elemI),elemO</span>
            <span class="c">#sqErr=MV.ESS(out,targ)</span>
            <span class="c">#print &quot;number of direct hits: &quot;,MV.classificationPerformance(out,targ)</span>


            <span class="c">#print &quot;epoch: %4d&quot; % trainer.totalepochs, \</span>
            <span class="c">#      &quot;  train error: %5.2f%%&quot; % trnresult, \</span>
            <span class="c">#      &quot;  test error: %5.2f%%&quot; % tstresult</span>

        <span class="n">trainer</span><span class="o">.</span><span class="n">trainUntilConvergence</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">maxEpochs</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">continueEpochs</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="c">#, validationProportion=0.25)</span>
        <span class="n">nnoutList</span><span class="o">=</span><span class="p">[];</span><span class="n">actualOutList</span><span class="o">=</span><span class="p">[]</span>
        <span class="c"># for (elemI,elemO) in zip(self._inputData,self._outData):</span>
        <span class="c">#     nnoutList.append(self._nn.activate(elemI))</span>
        <span class="c">#     actualOutList.append(elemO)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">elemI</span><span class="p">,</span><span class="n">elemO</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tstdata</span><span class="p">[</span><span class="s">&quot;input&quot;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_tstdata</span><span class="p">[</span><span class="s">&quot;target&quot;</span><span class="p">]):</span>
            <span class="n">nnoutList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">elemI</span><span class="p">))</span>
            <span class="n">actualOutList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elemO</span><span class="p">)</span>

        <span class="c">#we prepare the neural-network output from real space to 0 and 1:</span>
        <span class="n">estimationOut</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">liele</span> <span class="ow">in</span> <span class="n">nnoutList</span><span class="p">:</span>
            <span class="n">estimationOut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">liele</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">nnoutList</span><span class="p">)))</span>

        <span class="n">tmp</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">eleNO</span><span class="p">,</span><span class="n">eleAO</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">estimationOut</span><span class="p">,</span><span class="n">actualOutList</span><span class="p">):</span>
            <span class="n">tmp</span><span class="o">=</span><span class="n">tmp</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">eleNO</span><span class="o">-</span><span class="n">eleAO</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">actualOutList</span><span class="p">)</span>
            <span class="n">errorPercent</span><span class="o">=</span><span class="mf">100.</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">tmp</span><span class="p">)</span>

        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;The neuronal network predicted &quot;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">errorPercent</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s">&quot; </span><span class="si">% o</span><span class="s">f the test data correctly&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">estimationOut</span><span class="p">,</span><span class="n">actualOutList</span><span class="p">,</span><span class="n">errorPercent</span>
</div>
    <span class="k">def</span> <span class="nf">SetHiddenNeuronsAsMultipleOfInputNeurons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inputNumber</span><span class="p">):</span>
        <span class="n">ToassertF</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">inputNumber</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">,</span><span class="n">critical</span><span class="p">,</span><span class="s">&quot;input to SetHiddenNeuronsAsMultipleOfInputNeurons has to be an int&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_NONEURONSHIDDENLAYER_MULTIPLE_OF_INPUT_NEURONS</span><span class="o">=</span><span class="n">inputNumber</span>

    <span class="k">def</span> <span class="nf">GetHiddenNeuronsAsMultipleOfInputNeurons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NONEURONSHIDDENLAYER_MULTIPLE_OF_INPUT_NEURONS</span>

    <span class="k">def</span> <span class="nf">SetNoHiddenNeuronLayersMinMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inputMin</span><span class="p">,</span><span class="n">inputMax</span><span class="p">):</span>
        <span class="n">ToassertF</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">inputMax</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">inputMin</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">,</span><span class="n">critical</span><span class="p">,</span><span class="s">&quot;input to SetHiddenNeuronsAsMultipleOfInputNeurons has to be an int&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_NOHIDDENLAYERSMIN</span><span class="o">=</span><span class="n">inputMin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_NOHIDDENLAYERSMAX</span><span class="o">=</span><span class="n">inputMax</span>

    <span class="k">def</span> <span class="nf">ExecuteNeuralNetworkConfigurations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inputDatenNeuralNetwork</span><span class="p">,</span><span class="n">targetDatenNeuralNetwork</span><span class="p">):</span>

        <span class="c">#first set up the whole dataset for team1 and team2</span>
        <span class="c">#now we estimate using 4 different neural network sizes, with different number of hidden layers</span>
        <span class="n">outEstimate</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">outActual</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">errPrct</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">noNeuronsInHiddenLayer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_NONEURONSHIDDENLAYER_MULTIPLE_OF_INPUT_NEURONS</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">nohiddenLayers</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_NOHIDDENLAYERSMIN</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_NOHIDDENLAYERSMAX</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="c">#with 1 hidden Layer</span>
                <span class="p">[</span><span class="n">tmp1</span><span class="p">,</span><span class="n">tmp2</span><span class="p">,</span><span class="n">tmp3</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RunNeuralNetwork</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outNNEstimateList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outNNActual</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_errNNPrct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">PlotNeuralNetworkConfigurationResults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">noNeuronsInHiddenLayer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_NONEURONSHIDDENLAYER_MULTIPLE_OF_INPUT_NEURONS</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">nohiddenLayers</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_NOHIDDENLAYERSMIN</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_NOHIDDENLAYERSMAX</span><span class="p">):</span>

                <span class="k">print</span> <span class="s">&quot;results of a neural network conditioning with &quot;</span><span class="p">,</span><span class="n">nohiddenLayers</span><span class="p">,</span><span class="s">&quot; hidden layers and &quot;</span>
                <span class="k">print</span> <span class="s">&quot;number of neurons in hidden layers: &quot;</span><span class="p">,</span><span class="n">noNeuronsInHiddenLayer</span><span class="p">,</span><span class="s">&quot; times the neurons in the input layer&quot;</span>
                <span class="k">print</span> <span class="s">&quot;in the prediction of the full dataset &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_errNNPrct</span><span class="p">[</span><span class="n">nohiddenLayers</span><span class="p">],</span> <span class="s">&quot;</span><span class="si">% o</span><span class="s">f the data has been correctly predicted&quot;</span>

                <span class="n">plotid</span><span class="o">=</span><span class="p">(</span><span class="n">noNeuronsInHiddenLayer</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_NOHIDDENLAYERSMAX</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_NOHIDDENLAYERSMIN</span><span class="p">)</span><span class="o">+</span><span class="n">nohiddenLayers</span>
                <span class="n">NOPLOTS</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_NONEURONSHIDDENLAYER_MULTIPLE_OF_INPUT_NEURONS</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_NOHIDDENLAYERSMAX</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">NOPLOTS</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">NOPLOTS</span><span class="o">/</span><span class="mf">2.</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">NOPLOTS</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">plotid</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_outNNEstimateList</span><span class="p">[</span><span class="n">nohiddenLayers</span><span class="p">],</span><span class="s">&#39;o&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_outNNActual</span><span class="p">[</span><span class="n">nohiddenLayers</span><span class="p">])</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">])</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<div class="viewcode-block" id="NeuralNetworkAnalysisC.SetCurrentlyAnalyzedDataSetDict"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.NeuralNetworkAnalysisC.SetCurrentlyAnalyzedDataSetDict">[docs]</a>    <span class="k">def</span> <span class="nf">SetCurrentlyAnalyzedDataSetDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">typeString</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;as specified in input, read the input dataset from analysis class&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;input:</span>
<span class="sd">                string: type</span>
<span class="sd">                can be &quot;delta&quot;,&quot;summed&quot;,&quot;correlated&quot;,&quot;uncorrelated_normal&quot;,&quot;uncorrelated_uniform</span>
<span class="sd">           no output</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">Dataselector</span><span class="p">(</span><span class="n">typeString</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">AnalyzeMatchup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Team1Name</span><span class="p">,</span><span class="n">Team2Name</span><span class="p">,</span><span class="n">gesamtDatenTyp</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

        <span class="c">#self._currentlyAnalyzedDataType=self.AnaC.GetDataSetTypeList()[gesamtDatenTyp]</span>
        <span class="c">#gesamtDatenDict=self.AnaC.Dataselector(gesamtDatenTyp)</span>
        <span class="c">#choose the delta value dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCurrentlyAnalyzedDataSetDict</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetupNNDataMatchup</span><span class="p">(</span><span class="n">Team1Name</span><span class="p">,</span><span class="n">Team2Name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExecuteNeuralNetworkConfigurations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_targetData</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotNeuralNetworkConfigurationResults</span><span class="p">()</span>

<div class="viewcode-block" id="NeuralNetworkAnalysisC.SetupNNDataMatchup"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.NeuralNetworkAnalysisC.SetupNNDataMatchup">[docs]</a>    <span class="k">def</span> <span class="nf">SetupNNDataMatchup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Team1</span><span class="p">,</span><span class="n">Team2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;input:</span>
<span class="sd">                :param gesamtDatenDict</span>
<span class="sd">                            whole dataset for all seasons and stat categories</span>
<span class="sd">                :param Team1Name</span>
<span class="sd">                            name of team1 of matchup</span>
<span class="sd">                :param Team2Name:</span>
<span class="sd">                            name of team1 of matchup</span>
<span class="sd">            output: returns interna fields for</span>
<span class="sd">                _inputData</span>
<span class="sd">                            multivariate data with rows containing data for each matchup</span>
<span class="sd">                            and columns containing categorical data as follows:</span>
<span class="sd">                                #1 first team home matchup score, until current matchup - add only information of one match at time</span>
<span class="sd">                                #2 second team home matchup score (same as first team away matchup score), until current matchup</span>
<span class="sd">                                #3 first teams performance over last N games</span>
<span class="sd">                                #4 second teams performance over last N games</span>
<span class="sd">                                #5 days off the first team had before matchup</span>
<span class="sd">                                #6 days off the second team had before matchup</span>
<span class="sd">                _outData</span>
<span class="sd">                            the target data, in this case a one dimensional array</span>
<span class="sd">                            containing integer 1 if team1 won, else 0</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ToassertF</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="o">==</span><span class="p">[],</span><span class="n">critical</span><span class="p">,</span><span class="s">&quot;no dictionary for evaluaten chosen - call method SetCurrentlyAnalyzedDict before!&quot;</span><span class="p">)</span>

        <span class="c">#we concatenate all the data at our</span>
        <span class="n">allseasonData</span><span class="o">=</span><span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_allHomeGamesDatesTupleT1</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allHomeGamesDatesTupleT2</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="o">=</span><span class="p">[]</span>

        <span class="n">seasonList</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">seasonKey</span> <span class="ow">in</span> <span class="n">seasonList</span><span class="p">:</span>
            <span class="n">allseasonData</span><span class="o">=</span><span class="n">allseasonData</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="p">[</span><span class="n">seasonKey</span><span class="p">]</span>
            <span class="sd">&quot;&quot;&quot;the neural network input dataset has an entry for every matchup of the two teams&quot;&quot;&quot;</span>
            <span class="sd">&quot;&quot;&quot;get the unique identifier for every matchup - the triple, the id, the date and the season we are in&quot;&quot;&quot;</span>
            <span class="n">homeGameT1DateTupleList</span> <span class="o">=</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">ID</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">date</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">season</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="p">[</span><span class="n">seasonKey</span><span class="p">]</span> <span class="k">if</span> <span class="n">Team1</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">]</span> <span class="ow">and</span> <span class="n">Team2</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">awayTeam</span><span class="p">]]</span>
            <span class="n">homeGameT2DateTupleList</span> <span class="o">=</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">ID</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">date</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">season</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="p">[</span><span class="n">seasonKey</span><span class="p">]</span> <span class="k">if</span> <span class="n">Team2</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">]</span> <span class="ow">and</span> <span class="n">Team1</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">awayTeam</span><span class="p">]]</span>
            <span class="c">#numberOfMatchupsThisSeason=len(homeGameT1Date)+len(homeGameT2Date)</span>
            <span class="n">thisSeasonsTuple</span><span class="o">=</span><span class="n">homeGameT1DateTupleList</span><span class="o">+</span><span class="n">homeGameT2DateTupleList</span>
            <span class="c">#now sort the matchups after id, the first entry</span>
            <span class="n">thisSeasonsTupleSorted</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">thisSeasonsTuple</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c">#now we have an ordered</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="o">+</span><span class="n">thisSeasonsTupleSorted</span>
            <span class="c">#now the direct mapping from home games to dates and ids in two separate list of tuples</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_allHomeGamesDatesTupleT1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_allHomeGamesDatesTupleT1</span><span class="o">+</span><span class="n">homeGameT1DateTupleList</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_allHomeGamesDatesTupleT2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_allHomeGamesDatesTupleT2</span><span class="o">+</span><span class="n">homeGameT2DateTupleList</span>


        <span class="c">#generate the networks output data</span>
        <span class="c">#it consists in a lone number, 1 for win and 0 for loss of Team1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outData</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">),</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">)):</span>
            <span class="c">#we read all the entries of outData in the same order as that of the inputData!</span>
            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">season</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="c">#sets the wins for Team1 - so 0 for a loss, 1 for a win for team 1</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="p">[</span><span class="n">season</span><span class="p">]:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">id</span><span class="o">==</span><span class="n">element</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span> <span class="ow">and</span> <span class="n">season</span><span class="o">==</span><span class="n">element</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">season</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_outData</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">=</span><span class="n">element</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">wonYN</span><span class="p">]</span>

        <span class="c">#&quot;&quot;&quot;now merge the datasets&quot;&quot;&quot;</span>
        <span class="c">##totalMatchups=homeGameT1Date+homeGameT2Date</span>
        <span class="c">#&quot;&quot;&quot;then sort them&quot;&quot;&quot;</span>
        <span class="c">#dateMatchups=sorted(totalMatchups)</span>

        <span class="sd">&quot;&quot;&quot;inputData: array with all the matchups</span>
<span class="sd">                        has dimension of (all matchups x extracted features)</span>
<span class="sd">                        initialized to the largest negative number&quot;&quot;&quot;</span>
        <span class="c">#in rows the various games are stored, as numpy calls the array rowwise</span>
        <span class="c">#have six columns for input data</span>
        <span class="c">#we fill it with large negatives to identify non-filled areas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">),</span><span class="mi">6</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">__LARGENEGATIVE</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_homeGameT1</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">wonYN</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">allseasonData</span> <span class="k">if</span> <span class="n">Team1</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">]</span> <span class="ow">and</span> <span class="n">Team2</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">awayTeam</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_homeGameT2</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">wonYN</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">allseasonData</span> <span class="k">if</span> <span class="n">Team2</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">]</span> <span class="ow">and</span> <span class="n">Team1</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">awayTeam</span><span class="p">]]</span>

        <span class="sd">&quot;&quot;&quot;lists contain the chance for a win, assuming uniform distribution, according to games played up to the current date</span>
<span class="sd">        corresponds to #1 and #2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">winHomeChanceT1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GetWinChanceHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_homeGameT1</span><span class="p">)</span>
        <span class="n">winHomeChanceT2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GetWinChanceHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_homeGameT2</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot;now read the result in the global input data structure&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;we use the mapping arrays for team1 and team2 home games&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">)):</span>
            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">season</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="c">#it might not be found in homegames - then do nothing</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c">#no exception handling, as we are just going on</span>
                <span class="n">gotHomeIndex1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_allHomeGamesDatesTupleT1</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="nb">id</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">season</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">winHomeChanceT1</span><span class="p">[</span><span class="n">gotHomeIndex1</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="mi">1</span><span class="o">==</span><span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>

                <span class="n">gotHomeIndex2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_allHomeGamesDatesTupleT2</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="nb">id</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">season</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">winHomeChanceT2</span><span class="p">[</span><span class="n">gotHomeIndex2</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="mi">1</span><span class="o">==</span><span class="mi">1</span>

            <span class="c">#the first two rows are now filled with data</span>
            <span class="c">#the entries in between are now minus large constant - we have to fill them up with the latest value to remain consistent</span>
            <span class="c">#now do the mapping from home games to overall games</span>

        <span class="sd">&quot;&quot;&quot;the first and seconds team performance over the last N games&quot;&quot;&quot;</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        now lets call the function to evaluate for a certain id and season the teams performance over the last couple of games</span>
<span class="sd">        as well as reading the difference in the ids to get the days between the last match of the team and the current matchup</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span><span class="o">=</span><span class="mi">5</span>
        <span class="c">#this is slow (loop) and non-pythonic but readable</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">)):</span>
            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">season</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="p">[</span><span class="n">performanceTeam1</span><span class="p">,</span><span class="n">dateOfLastGame1</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AssessLastNGamesHelper</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="n">season</span><span class="p">,</span><span class="n">Team1</span><span class="p">,</span><span class="n">allseasonData</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
            <span class="p">[</span><span class="n">performanceTeam2</span><span class="p">,</span><span class="n">dateOfLastGame2</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AssessLastNGamesHelper</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="n">season</span><span class="p">,</span><span class="n">Team2</span><span class="p">,</span><span class="n">allseasonData</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">performanceTeam1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="n">performanceTeam2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">date</span><span class="o">-</span><span class="n">dateOfLastGame1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">date</span><span class="o">-</span><span class="n">dateOfLastGame2</span><span class="p">)</span>


        <span class="sd">&quot;&quot;&quot;fillUpZeroElementsInInputData: we fill up the data which has not been written in the input dataset for the neural network</span>
<span class="sd">        unfilled values, which are filled&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">FillUpZeroElementsInInputDataHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="p">)</span>

        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;Finished the preparation of input data for Neural Network.&quot;</span><span class="p">)</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;The input dataset contains &quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputDataSetTuple</span><span class="p">)),</span><span class="s">&quot; samples &quot;</span><span class="p">)</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;We have &quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputData</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span><span class="s">&quot; input datasets and one output dataset&quot;</span><span class="p">)</span>

        <span class="c">#return inputData,outData</span>

</div>
    <span class="k">def</span> <span class="nf">FillUpZeroElementsInInputDataHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inputData</span><span class="p">):</span>
        <span class="n">noColumns</span><span class="o">=</span><span class="n">inputData</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lastfiniteValue</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">noColumns</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inputData</span><span class="p">)),</span><span class="n">inputData</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">column</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)),</span><span class="n">row</span><span class="p">):</span>
                <span class="c">#if the entry is a large negative number, we have to fill up the value with that of the ls</span>
                <span class="k">if</span> <span class="n">column</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">__LARGENEGATIVE</span><span class="p">:</span>
                    <span class="n">inputData</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">lastfiniteValue</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lastfiniteValue</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">column</span>


<div class="viewcode-block" id="NeuralNetworkAnalysisC.AssessLastNGamesHelper"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.NeuralNetworkAnalysisC.AssessLastNGamesHelper">[docs]</a>    <span class="k">def</span> <span class="nf">AssessLastNGamesHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">currentDate</span><span class="p">,</span><span class="n">currentSeason</span><span class="p">,</span><span class="n">Team</span><span class="p">,</span><span class="n">fullData</span><span class="p">,</span><span class="n">NLastGames</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;assess the performance of the team for the last N games</span>
<span class="sd">        starting from</span>
<span class="sd">        input   id</span>
<span class="sd">        input   season for team</span>
<span class="sd">        input   Team</span>
<span class="sd">        input   full dataset over all seasons</span>
<span class="sd">        input   NLastGames: number of games to sum over (shifted sum)</span>
<span class="sd">        output  number of team wins in last N performances</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#read tuple with wins and ID -&gt; from id extract the id of last game played</span>
        <span class="n">gameResultsBeforeDate</span><span class="o">=</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">wonYN</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">date</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">fullData</span> <span class="k">if</span> <span class="p">((</span><span class="n">Team</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">currentSeason</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">season</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">date</span><span class="p">]</span><span class="o">&lt;</span><span class="n">currentDate</span><span class="p">))</span> <span class="p">]</span>
        <span class="c">#wins for the away team have to be inverted 0---&gt;1; add one!</span>
        <span class="n">tmpTupleList</span><span class="o">=</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">wonYN</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">date</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">fullData</span> <span class="k">if</span> <span class="p">((</span><span class="n">Team</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">awayTeam</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">currentSeason</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">season</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">date</span><span class="p">]</span><span class="o">&lt;</span><span class="n">currentDate</span><span class="p">))</span> <span class="p">]</span>
        <span class="c">#now invertResults an away loss is 0 -&gt; convert to one</span>
        <span class="n">invertedGameResultsBeforeDate</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="nb">tuple</span> <span class="ow">in</span> <span class="n">tmpTupleList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">invertedGameResultsBeforeDate</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="nb">tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">invertedGameResultsBeforeDate</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="nb">tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">gameResultsBeforeDate</span><span class="o">=</span><span class="n">gameResultsBeforeDate</span><span class="o">+</span><span class="n">invertedGameResultsBeforeDate</span>
        <span class="c">#at index [-1][1] we find the last tuple in the list, and there the id!</span>
        <span class="n">idOfLastGamePlayed</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">tuple1</span><span class="p">,</span><span class="n">tuple2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gameResultsBeforeDate</span><span class="p">,</span><span class="n">invertedGameResultsBeforeDate</span><span class="p">):</span>
            <span class="n">id1</span><span class="o">=</span><span class="n">tuple1</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="n">id2</span><span class="o">=</span><span class="n">tuple2</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">idOfLastGamePlayed</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">idOfLastGamePlayed</span><span class="p">,</span><span class="n">id1</span><span class="p">)</span>
            <span class="n">idOfLastGamePlayed</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">idOfLastGamePlayed</span><span class="p">,</span><span class="n">id2</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        output:</span>
<span class="sd">        the number of wins in the last N games for the data filtered!</span>
<span class="sd">        This is a slow but readable approach</span>
<span class="sd">        summing weighs every win with one, every loss with zero</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#the zero index in the sum aims at the EN.wonYN statistics, the first entry in the tuple</span>
        <span class="n">sumt</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="nb">tuple</span> <span class="ow">in</span> <span class="n">gameResultsBeforeDate</span><span class="p">[</span><span class="o">-</span><span class="n">NLastGames</span><span class="p">:]:</span>
            <span class="n">sumt</span><span class="o">=</span><span class="n">sumt</span><span class="o">+</span><span class="nb">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">sumt</span><span class="p">,</span><span class="n">idOfLastGamePlayed</span>

</div>
<div class="viewcode-block" id="NeuralNetworkAnalysisC.GetWinChanceHelper"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.NeuralNetworkAnalysisC.GetWinChanceHelper">[docs]</a>    <span class="k">def</span> <span class="nf">GetWinChanceHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">homeGame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        input:</span>
<span class="sd">                list of 0 and 1, 1 for win, 0 for loss</span>
<span class="sd">        output:</span>
<span class="sd">                list with sums up to the list index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">returnList</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">addedScore</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ele</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">homeGame</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">homeGame</span><span class="p">):</span>
            <span class="n">addedScore</span><span class="o">=</span><span class="n">addedScore</span><span class="o">+</span><span class="n">ele</span>
            <span class="c">#calculate probability assuming a uniform distribution</span>
            <span class="c">#divide by all elements until now, assuming uniform distribution</span>
            <span class="n">returnList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">addedScore</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">returnList</span>
</div></div>
<div class="viewcode-block" id="WaveletAnalysisC"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.WaveletAnalysisC">[docs]</a><span class="k">class</span> <span class="nc">WaveletAnalysisC</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;not really derived from AnalysisC, just lends some methods and shared data for all methods&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">AnalysisC</span><span class="p">):</span><span class="c">#prepareDataC):</span>
        <span class="c">#we do not instantiate the AnalysisC class, but just share some knowledge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">=</span><span class="n">AnalysisC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetEN</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_waveletInputDataListofList</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cwtmatrListOfLists</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ENList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetENList</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analyzedSeasonList</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataType</span><span class="o">=</span><span class="s">&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">PrepareTheData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gesamtDatenDict</span><span class="p">,</span><span class="n">dataKategory</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">seasonKey</span> <span class="ow">in</span> <span class="n">gesamtDatenDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">seasonData</span><span class="o">=</span><span class="n">gesamtDatenDict</span><span class="p">[</span><span class="n">seasonKey</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_analyzedSeasonList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seasonKey</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_waveletInputDataListofList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">FetchDataAndAverageOverOneGameday</span><span class="p">(</span><span class="n">seasonData</span><span class="p">,</span><span class="n">dataKategory</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">Analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kategory</span><span class="p">,</span><span class="n">gesamtDatenTyp</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataType</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetDataSetTypeList</span><span class="p">()[</span><span class="n">gesamtDatenTyp</span><span class="p">]</span>
        <span class="n">gesamtDatenDict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">Dataselector</span><span class="p">(</span><span class="n">gesamtDatenTyp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrepareTheData</span><span class="p">(</span><span class="n">gesamtDatenDict</span><span class="p">,</span><span class="n">kategory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DoTheWaveletTransformForList</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotWaveletList</span><span class="p">(</span><span class="n">kategory</span><span class="p">)</span>
        <span class="c">#self.PrepareTheData(self.AnaC.GetDataSetType().original,self.__EN.PenaltyminutesDiff)</span>
        <span class="c">#self.DoTheWaveletTransformForList()</span>
        <span class="c">#self.PlotWaveletList()</span>

    <span class="k">def</span> <span class="nf">AnalyzePIM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrepareTheData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetDataSetType</span><span class="p">()</span><span class="o">.</span><span class="n">original</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">PenaltyminutesDiff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DoTheWaveletTransformForList</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotWaveletList</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">DoTheWaveletTransformForList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">dataForOneSeason</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waveletInputDataListofList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cwtmatrListOfLists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DoTheWaveletTransform</span><span class="p">(</span><span class="n">dataForOneSeason</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">DoTheWaveletTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inputData</span><span class="p">):</span>
        <span class="n">widths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">tmpCwtmatr</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cwt</span><span class="p">(</span><span class="n">inputData</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">ricker</span><span class="p">,</span> <span class="n">widths</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tmpCwtmatr</span>

    <span class="k">def</span> <span class="nf">PlotWaveletList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kategory</span><span class="p">):</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">season</span><span class="p">,</span><span class="n">transformedDataSet</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_analyzedSeasonList</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwtmatrListOfLists</span><span class="p">):</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ENList</span><span class="p">[</span><span class="n">kategory</span><span class="p">]),</span><span class="s">&quot; | &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataType</span><span class="p">,</span><span class="s">&quot; | season &quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">season</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PlotWavelets</span><span class="p">(</span><span class="n">transformedDataSet</span><span class="p">,</span><span class="n">title</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">PlotWavelets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inputData</span><span class="p">,</span><span class="n">titleMessage</span><span class="p">):</span>

        <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetAndIncreaseGlobalFigureID</span><span class="p">())</span>
        <span class="n">inputTransformed</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">inputData</span><span class="p">)</span>
        <span class="c">#cmap=&#39;PRGn&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">inputTransformed</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;hot&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">inputTransformed</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">vmin</span><span class="o">=-</span><span class="nb">abs</span><span class="p">(</span><span class="n">inputTransformed</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">titleMessage</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;game day [d]&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;wavelet component&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="BivariateAnalysisC"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.BivariateAnalysisC">[docs]</a><span class="k">class</span> <span class="nc">BivariateAnalysisC</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;not really derived from AnalysisC, just lends some methods and shared data for all methods&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">AnalysisC</span><span class="p">):</span><span class="c">#prepareDataC):</span>
        <span class="c">#we do not instantiate the AnalysisC class, but just share some knowledge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">=</span><span class="n">AnalysisC</span>
        <span class="c">#AnalysisC.__init__(self,prepareDataC)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_listDtLost</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_listDtWon</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_corrAboveThresholdDict</span><span class="o">=</span><span class="p">{}</span>

        <span class="c">#self._gesamtDatenDict=AnalysisCI.__gesamtDatenDict</span>

    <span class="k">def</span> <span class="nf">ComputeAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#self.computeHistogramsHelper()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ComputeTimeWinStatistics</span><span class="p">()</span>

<div class="viewcode-block" id="BivariateAnalysisC.ComputeTimeWinStatistics"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.BivariateAnalysisC.ComputeTimeWinStatistics">[docs]</a>    <span class="k">def</span> <span class="nf">ComputeTimeWinStatistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dataTypeID</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;compute the histograms of data in a season for two datasets - bivariate&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        input: dataType:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c">#ToassertF(AnalysisC.__gesamtDatenDict=={},critical,&quot;general data dictionary _gesamtDatenDict is empty&quot;)</span>

        <span class="n">EN</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetEN</span><span class="p">()</span>
        <span class="n">gesamtDatenDict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">Dataselector</span><span class="p">(</span><span class="n">dataTypeID</span><span class="p">)</span>
        <span class="c">#VerbosityF(2,&quot;dataType &quot;,dataTypeID,&quot; gesDaten erster Datensatz: &quot;,gesamtDatenDict[2010][0:3])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_listDtWon</span><span class="o">=</span><span class="p">[];</span><span class="bp">self</span><span class="o">.</span><span class="n">_listDtLost</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">seasonKey</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">gesamtDatenDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="nb">sorted</span><span class="p">(</span><span class="n">gesamtDatenDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">seasonData</span><span class="o">=</span><span class="n">gesamtDatenDict</span><span class="p">[</span><span class="n">seasonKey</span><span class="p">]</span>
            <span class="n">Teams</span><span class="o">=</span><span class="nb">set</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">seasonData</span><span class="p">])</span>
            <span class="c">#have to split up for teams, as statistic is evaluated separately for every team</span>
            <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">Teams</span><span class="p">:</span>
                <span class="n">listWonYNDate</span><span class="o">=</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">date</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">wonYN</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">seasonData</span> <span class="k">if</span> <span class="n">team</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">]</span> <span class="ow">or</span> <span class="n">team</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">awayTeam</span><span class="p">]]</span>
                <span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">listDtWon</span><span class="o">=</span><span class="p">[]</span><span class="c">#[0]*max(len(seasonData),len(seasonData[0]));</span>
                <span class="c">#[0]*max(len(seasonData),len(seasonData[0]));listWon=[];</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">listWonYNDate</span><span class="p">:</span>
                    <span class="n">date</span><span class="o">=</span><span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">prevDate</span><span class="o">=</span><span class="n">date</span>
                    <span class="n">deltaDate</span><span class="o">=</span><span class="n">date</span><span class="o">-</span><span class="n">prevDate</span>
                    <span class="k">if</span> <span class="n">deltaDate</span><span class="o">&lt;</span><span class="mi">10</span> <span class="ow">and</span> <span class="n">deltaDate</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="c">#team has won</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_listDtWon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deltaDate</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_listDtLost</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deltaDate</span><span class="p">)</span>
                    <span class="n">prevDate</span><span class="o">=</span><span class="n">date</span>
                    <span class="n">it</span><span class="o">=</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span>
</div>
    <span class="k">def</span> <span class="nf">ReturnWinList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_listDtWon</span>

    <span class="k">def</span> <span class="nf">ReturnLossList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_listDtLost</span>


    <span class="k">def</span> <span class="nf">CalcAndPlot2HistogramsBivariate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">histoData1</span><span class="p">,</span><span class="n">histoData2</span><span class="p">,</span><span class="n">message</span><span class="p">,</span><span class="n">labelX</span><span class="p">,</span><span class="n">labelY</span><span class="p">):</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetAndIncreaseGlobalFigureID</span><span class="p">())</span>
        <span class="n">wgh1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">histoData1</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">histoData1</span><span class="p">))</span>
        <span class="n">wgh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">histoData2</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">histoData2</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">message</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">histoData1</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="n">wgh1</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;win&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">labelX</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">histoData2</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="n">wgh2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;loss&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">labelY</span><span class="p">)</span>
        <span class="c">#plt.xlabel(&quot;days between games [d]&quot;)</span>
        <span class="c">#plt.ylabel(&quot;probability of event&quot;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">PlotScatterBivariate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dataTypeID</span><span class="p">,</span><span class="n">EnumData1</span><span class="p">,</span><span class="n">EnumData2</span><span class="p">):</span>

        <span class="n">gesamtDatenDict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">Dataselector</span><span class="p">(</span><span class="n">dataTypeID</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">seasonKey</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">gesamtDatenDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="nb">sorted</span><span class="p">(</span><span class="n">gesamtDatenDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="c">#print i,seasonKey</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetAndIncreaseGlobalFigureID</span><span class="p">())</span>
            <span class="n">seasonData</span><span class="o">=</span><span class="n">gesamtDatenDict</span><span class="p">[</span><span class="n">seasonKey</span><span class="p">]</span>
            <span class="n">hits</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">EnumData1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">seasonData</span><span class="p">]</span>
            <span class="n">pim</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">EnumData2</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">seasonData</span><span class="p">]</span>
            <span class="c">#ax = plt.subplot(len(gesamtDatenDict.keys())/2,2,i)</span>
            <span class="c">#plt.subplots_adjust(wspace=0.4,hspace=0.4)</span>
            <span class="c">#ax.set_xlabel(&#39;penalty minutes&#39;)</span>
            <span class="c">#ax.set_ylabel(&#39;hits&#39;)</span>
            <span class="c">#plt.title(&quot;&quot;.join(&quot;season &quot;+str(seasonKey)))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">hits</span><span class="p">,</span><span class="n">pim</span><span class="p">)</span>
        <span class="c">#    plt.legend([&quot;pim in home wins&quot;,&quot;pim in home losses&quot;])</span>


    <span class="k">def</span> <span class="nf">ScanForBivariateCorrelations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dataTypeID</span><span class="p">,</span><span class="n">crossCorrelationThreshold</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>

        <span class="n">gesamtDatenDict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">Dataselector</span><span class="p">(</span><span class="n">dataTypeID</span><span class="p">)</span>
        <span class="n">collectedCovList</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">EN</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetEN</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">seasonKey</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">gesamtDatenDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="nb">sorted</span><span class="p">(</span><span class="n">gesamtDatenDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">seasonData</span><span class="o">=</span><span class="n">gesamtDatenDict</span><span class="p">[</span><span class="n">seasonKey</span><span class="p">]</span>
            <span class="n">Teams</span><span class="o">=</span><span class="nb">set</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">seasonData</span><span class="p">])</span>
            <span class="n">captionList</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;WonYN&quot;</span><span class="p">,</span><span class="s">&quot;ScoreDiff&quot;</span><span class="p">,</span><span class="s">&quot;ShDiff&quot;</span><span class="p">,</span><span class="s">&quot;FaceoffDiff&quot;</span><span class="p">,</span><span class="s">&quot;TakeawayDiff&quot;</span><span class="p">,</span> \
             <span class="s">&quot;GiveawaysDiff&quot;</span><span class="p">,</span><span class="s">&quot;PenaltyminutesDiff&quot;</span><span class="p">,</span><span class="s">&quot;HitsDiff&quot;</span><span class="p">,</span><span class="s">&quot;powerplayGoalsDiff&quot;</span><span class="p">]</span>
            <span class="n">foundValues</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">Teams</span><span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">p</span><span class="p">[</span>\
                        <span class="n">EN</span><span class="o">.</span><span class="n">wonYN</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">ScoreDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">ShDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">FaceoffDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">TakeawayDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">GiveawaysDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">PenaltyminutesDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">HitsDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">powerplayGoalsDiff</span><span class="p">],</span>\
                       <span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">seasonData</span> <span class="k">if</span> <span class="n">team</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">]</span> <span class="ow">or</span> <span class="n">team</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="n">EN</span><span class="o">.</span><span class="n">awayTeam</span><span class="p">]]</span>
                <span class="n">dataArray</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">collectedCov</span><span class="o">=</span><span class="p">[]</span>
                <span class="c">#start at index 1 - omit correlation of score and win</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">dataArray</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">dataArray</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                            <span class="n">data1</span><span class="o">=</span><span class="n">dataArray</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
                            <span class="n">data2</span><span class="o">=</span><span class="n">dataArray</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span>
                            <span class="c">#print &quot;mean:&quot;,&quot;\t&quot;,&#39;{:.2f}&#39;.format(np.mean(hitsD[team])),&quot;|&quot;,&#39;{:.2f}&#39;.format(np.mean(pimD[team]))</span>
                            <span class="c">#print &quot;standard deviation: &quot;,&quot;\t&quot;,&#39;{:.2f}&#39;.format(np.std(hitsD[team])),&quot;|&quot;,&#39;{:.2f}&#39;.format(np.std(pimD[team]))</span>
                            <span class="c">#print &quot;skewness: &quot;,&quot;\t&quot;,&#39;{:.2f}&#39;.format(stats.skew(hitsD[team])),&quot;|&quot;,&#39;{:.2f}&#39;.format(stats.skew(pimD[team]))</span>
                            <span class="c">#print &quot;kurtosis: &quot;,&quot;\t&quot;,&#39;{:.2f}&#39;.format(stats.kurtosis(hitsD[team])),&quot;|&quot;,&#39;{:.2f}&#39;.format(stats.kurtosis(pimD[team]))</span>
                            <span class="n">ddata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">])</span>
                            <span class="n">calcCov</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">ddata</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">calcCov</span><span class="p">)</span><span class="o">&gt;</span><span class="n">crossCorrelationThreshold</span><span class="p">:</span>
                                <span class="n">foundValues</span><span class="o">=</span><span class="n">foundValues</span><span class="o">+</span><span class="mi">1</span>
                                <span class="n">collectedCov</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calcCov</span><span class="p">)</span>
                                <span class="n">kategory1</span><span class="o">=</span><span class="n">captionList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                <span class="n">kategory2</span><span class="o">=</span><span class="n">captionList</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                                <span class="n">teamTmpDict</span><span class="o">=</span><span class="p">{}</span>
                                <span class="n">teamTmpDict</span><span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;scatter&quot;</span>
                                <span class="n">teamTmpDict</span><span class="p">[</span><span class="s">&quot;correlCoeff&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">calcCov</span>
                                <span class="c">#teamTmpDict[&quot;team&quot;]=team</span>
                                <span class="n">teamTmpDict</span><span class="p">[</span><span class="s">&quot;dataX&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">data1</span>
                                <span class="n">teamTmpDict</span><span class="p">[</span><span class="s">&quot;dataY&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">data2</span>
                                <span class="n">teamTmpDict</span><span class="p">[</span><span class="s">&quot;titleString&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">seasonKey</span><span class="p">),</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">team</span><span class="p">),</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span><span class="n">kategory1</span><span class="p">,</span><span class="s">&quot; vs.&quot;</span><span class="p">,</span><span class="n">kategory2</span><span class="p">])</span>
                                <span class="c">#if not (kategory1,kategory2) in self._corrAboveThresholdZaehlerDict:</span>
                                <span class="c">#    self._corrAboveThresholdZaehlerDict[(kategory1,kategory2)]=0</span>
                                <span class="c">#else:</span>
                                <span class="c">#    self._corrAboveThresholdZaehlerDict[(kategory1,kategory2)]=self._corrAboveThresholdZaehlerDict[(kategory1,kategory2)]+1</span>
                                <span class="c">#id=self._corrAboveThresholdZaehlerDict[(kategory1,kategory2)]</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_corrAboveThresholdDict</span><span class="p">[(</span><span class="n">kategory1</span><span class="p">,</span><span class="n">kategory2</span><span class="p">,</span><span class="n">team</span><span class="p">)]</span><span class="o">=</span><span class="n">teamTmpDict</span>
                                <span class="c">#plt.figure(self.AnaC.GetAndIncreaseGlobalFigureID())</span>
                                <span class="c">#plt.scatter(data1,data2)</span>
                                <span class="c">#plt.title(&quot;&quot;.join([str(seasonKey),&quot;\t&quot;,str(team),&quot;\t&quot;,captionList[i],&quot;\t&quot;,captionList[j]]))</span>
                                <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;for team: &quot;</span><span class="p">,</span><span class="n">team</span><span class="p">,</span><span class="s">&quot; the crosscorrelation threshold of &quot;</span><span class="p">,</span> <span class="n">crossCorrelationThreshold</span><span class="p">,</span>\
                                <span class="s">&quot; is surpassed for categories &quot;</span><span class="p">,</span> <span class="n">captionList</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s">&quot; and &quot;</span><span class="p">,</span> <span class="n">captionList</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="s">&quot;!&quot;</span><span class="p">)</span>
                                <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;crosscorrelation value is &quot;</span><span class="p">,</span><span class="n">calcCov</span><span class="p">)</span>
                        <span class="c">#for every team append the covariance value</span>
                <span class="c">#collectedCovList.append(collectedCov)</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;We found &quot;</span><span class="p">,</span><span class="n">foundValues</span><span class="p">,</span> <span class="s">&quot; bivariate datapairs with higher correlation then threshold of &quot;</span><span class="p">,</span><span class="n">crossCorrelationThreshold</span><span class="p">)</span>


<div class="viewcode-block" id="BivariateAnalysisC.PlotAllFromDict2D"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.BivariateAnalysisC.PlotAllFromDict2D">[docs]</a>    <span class="k">def</span> <span class="nf">PlotAllFromDict2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dictionary</span><span class="p">,</span><span class="n">titleSupplement</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;import a 2d dictionary and plot all data it contains&quot;&quot;&quot;</span>

        <span class="n">harvesterOfTuples</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">for</span> <span class="n">keyTuple</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c">#we assemble a list of tuples already visited</span>
            <span class="k">if</span> <span class="n">keyTuple</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">harvesterOfTuples</span><span class="p">:</span>
                <span class="n">subDict</span><span class="o">=</span><span class="n">dictionary</span><span class="p">[</span><span class="n">keyTuple</span><span class="p">]</span>
                <span class="n">xAxisString</span><span class="o">=</span><span class="n">keyTuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">yAxisString</span><span class="o">=</span><span class="n">keyTuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">team</span><span class="o">=</span><span class="n">keyTuple</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">harvesterOfTuples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">keyTuple</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subDict</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">subDict</span><span class="p">:</span>
                        <span class="n">plotType</span><span class="o">=</span><span class="n">subDict</span><span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ToassertF</span><span class="p">(</span><span class="mi">1</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="n">critical</span><span class="p">,</span><span class="s">&quot;did not find key type in plotting dictionary - quit&quot;</span><span class="p">)</span>

                    <span class="n">titleString</span><span class="o">=</span><span class="n">subDict</span><span class="p">[</span><span class="s">&quot;titleString&quot;</span><span class="p">]</span>
                    <span class="c">#if &quot;team&quot; in subDict:</span>
                        <span class="c">#team=subDict[&quot;team&quot;]</span>
                        <span class="c">#legendStringList.append(team)</span>

                    <span class="k">if</span> <span class="n">plotType</span><span class="o">==</span><span class="s">&quot;scatter&quot;</span><span class="p">:</span>

                            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetAndIncreaseGlobalFigureID</span><span class="p">())</span>
                            <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">titleSupplement</span><span class="p">,</span><span class="n">titleString</span><span class="p">]))</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xAxisString</span><span class="p">)</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">yAxisString</span><span class="p">)</span>

                            <span class="c">#now get all the teams value for this pair of data lists</span>

                            <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">_TeamList</span><span class="p">:</span>

                                <span class="k">if</span> <span class="p">(</span><span class="n">xAxisString</span><span class="p">,</span><span class="n">yAxisString</span><span class="p">,</span><span class="n">team</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span>
                                    <span class="n">z</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                                    <span class="n">green</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
                                    <span class="n">red</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
                                    <span class="n">thirdC</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                                    <span class="c">#zcolor=z*green#+(1-z)*red+(0.5-z)*thirdC</span>
                                    <span class="n">zcolor</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
                                    <span class="n">fetchForTuple</span><span class="o">=</span><span class="p">(</span><span class="n">xAxisString</span><span class="p">,</span><span class="n">yAxisString</span><span class="p">,</span><span class="n">team</span><span class="p">)</span>
                                    <span class="n">subDi</span><span class="o">=</span><span class="n">dictionary</span><span class="p">[</span><span class="n">fetchForTuple</span><span class="p">]</span>
                                    <span class="c">#now add the tuple to the exclusion list</span>
                                    <span class="n">harvesterOfTuples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fetchForTuple</span><span class="p">)</span>
                                    <span class="n">dataX</span><span class="o">=</span><span class="n">subDi</span><span class="p">[</span><span class="s">&quot;dataX&quot;</span><span class="p">]</span>
                                    <span class="n">dataY</span><span class="o">=</span><span class="n">subDi</span><span class="p">[</span><span class="s">&quot;dataY&quot;</span><span class="p">]</span>
                                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dataX</span><span class="p">,</span><span class="n">dataY</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">zcolor</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">team</span><span class="p">)</span>

                            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">);</span>
</div></div>
<div class="viewcode-block" id="MultivariateStatisticsC"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MultivariateStatisticsC">[docs]</a><span class="k">class</span> <span class="nc">MultivariateStatisticsC</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot;not really derived from AnalysisC, just lends some methods and shared data for all methods&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">AnalysisC</span><span class="p">):</span><span class="c">#prepareDataC):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
            <span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">chi2_kernel</span><span class="p">,</span><span class="n">laplacian_kernel</span><span class="p">,</span><span class="n">linear_kernel</span><span class="p">,</span><span class="n">polynomial_kernel</span><span class="p">,</span><span class="n">rbf_kernel</span>

        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c">#we do not instantiate the AnalysisC class, but just share some knowledge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">=</span><span class="n">AnalysisC</span>
        <span class="c">#AnalysisC.__init__(self,prepareDataC)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_listDtLost</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_listDtWon</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_corrAboveThresholdDict</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mappingMatrix</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetEN</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ENList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetENList</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__teamList</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetTeamList</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compactMultivariateData</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compactMultivariateDataAllSeasons</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_kernel</span><span class="o">=</span><span class="n">linear_kernel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rbf_kernel</span><span class="o">=</span><span class="n">rbf_kernel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minPath</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">def</span> <span class="nf">GetData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gesamtDatenTyp</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataType</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetDataSetTypeList</span><span class="p">()[</span><span class="n">gesamtDatenTyp</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">Dataselector</span><span class="p">(</span><span class="n">gesamtDatenTyp</span><span class="p">)</span>


<div class="viewcode-block" id="MultivariateStatisticsC.GetMatchupDataBetweenTeamsAllSeasons"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MultivariateStatisticsC.GetMatchupDataBetweenTeamsAllSeasons">[docs]</a>    <span class="k">def</span> <span class="nf">GetMatchupDataBetweenTeamsAllSeasons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">team1</span><span class="p">,</span><span class="n">team2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;compile the data of matchups between two teams over multiple seasons</span>
<span class="sd">        and store in self._currentlyAnalyzedDataDict&quot;&quot;&quot;</span>

        <span class="n">allseasonData</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">seasonKey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetSeasonList</span><span class="p">():</span>
            <span class="n">allseasonData</span><span class="o">=</span><span class="n">allseasonData</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="p">[</span><span class="n">seasonKey</span><span class="p">]</span>
            <span class="sd">&quot;&quot;&quot;the neural network input dataset has an entry for every matchup of the two teams&quot;&quot;&quot;</span>
            <span class="sd">&quot;&quot;&quot;get the unique identifier for every matchup - the triple, the id, the date and the season we are in&quot;&quot;&quot;</span>
        <span class="n">GameDataList</span> <span class="o">=</span><span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">allseasonData</span> <span class="k">if</span> <span class="p">((</span><span class="n">team1</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">]</span> <span class="ow">and</span> <span class="n">team2</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">awayTeam</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">team2</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">]</span> <span class="ow">and</span> <span class="n">team1</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">awayTeam</span><span class="p">]))</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="p">[</span><span class="s">&quot;all seasons - matchup&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">GameDataList</span>
            <span class="c">#homeGameT2DataList =[(p for p in self._currentlyAnalyzedDataDict[seasonKey] if team2==p[self.__EN.homeTeam] and team1==p[self.__EN.awayTeam]]</span>
            <span class="c">#numberOfMatchupsThisSeason=len(homeGameT1Date)+len(homeGameT2Date)</span>
            <span class="c">#thisSeasonsTuple=homeGameT1DateTupleList+homeGameT2DateTupleList</span>
            <span class="c">#now sort the matchups after id, the first entry</span>
            <span class="c">#thisSeasonsTupleSorted=sorted(thisSeasonsTuple,key=lambda row: row[0])</span>
</div>
<div class="viewcode-block" id="MultivariateStatisticsC.PrepareData"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MultivariateStatisticsC.PrepareData">[docs]</a>    <span class="k">def</span> <span class="nf">PrepareData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;we read the 9 categories for use in multivariate analysis&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">seasonKey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">seasonData</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_currentlyAnalyzedDataDict</span><span class="p">[</span><span class="n">seasonKey</span><span class="p">]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">team</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__teamList</span><span class="p">)),</span><span class="bp">self</span><span class="o">.</span><span class="n">__teamList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_compactMultivariateData</span><span class="p">[</span><span class="n">team</span><span class="p">,</span><span class="n">seasonKey</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">p</span><span class="p">[</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">date</span><span class="p">],</span>\
                        <span class="c">#p[self.__EN.wonYN],\</span>
                        <span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">ScoreDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">ShDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">FaceoffDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">TakeawayDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">GiveawaysDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">PenaltyminutesDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">HitsDiff</span><span class="p">],</span>\
                        <span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">powerplayGoalsDiff</span><span class="p">],</span>\
                       <span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">seasonData</span> <span class="k">if</span> <span class="n">team</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">homeTeam</span><span class="p">]</span> <span class="ow">or</span> <span class="n">team</span><span class="o">==</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EN</span><span class="o">.</span><span class="n">awayTeam</span><span class="p">]]</span>

                <span class="k">if</span> <span class="n">team</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compactMultivariateDataAllSeasons</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_compactMultivariateDataAllSeasons</span><span class="p">[</span><span class="n">team</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_compactMultivariateData</span><span class="p">[</span><span class="n">team</span><span class="p">,</span><span class="n">seasonKey</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_compactMultivariateDataAllSeasons</span><span class="p">[</span><span class="n">team</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_compactMultivariateDataAllSeasons</span><span class="p">[</span><span class="n">team</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_compactMultivariateData</span><span class="p">[</span><span class="n">team</span><span class="p">,</span><span class="n">seasonKey</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="MultivariateStatisticsC.KernelMapping"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MultivariateStatisticsC.KernelMapping">[docs]</a>    <span class="k">def</span> <span class="nf">KernelMapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kernelName</span><span class="p">,</span><span class="n">team</span><span class="p">,</span><span class="n">gesamtDatenTyp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;do a kernel mapping from KxN space to NxN space</span>
<span class="sd">        by applying various mapping functions to the input data&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">GetData</span><span class="p">(</span><span class="n">gesamtDatenTyp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrepareData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MultivariateKernelMappingOneTeam</span><span class="p">(</span><span class="n">kernelName</span><span class="p">,</span><span class="n">team</span><span class="p">)</span>
        <span class="c">#self.PlotDistanceMatrix2D()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FindMinPathThrougData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotDistanceMatrix2D</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotDistanceMatrix3D</span><span class="p">()</span>

</div>
    <span class="k">def</span> <span class="nf">AnalyzeMatchup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kernelName</span><span class="p">,</span><span class="n">team1</span><span class="p">,</span><span class="n">team2</span><span class="p">,</span><span class="n">gesamtDatenTyp</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">GetData</span><span class="p">(</span><span class="n">gesamtDatenTyp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetMatchupDataBetweenTeamsAllSeasons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrepareData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MultivariateKernelMappingOneTeam</span><span class="p">(</span><span class="n">kernelName</span><span class="p">,</span><span class="n">team</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">MultivariateKernelMappingOneTeam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kernelName</span><span class="p">,</span><span class="n">team</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">KernelWrapper</span><span class="p">(</span><span class="n">kernelName</span><span class="p">,</span><span class="n">team</span><span class="p">)</span>

<div class="viewcode-block" id="MultivariateStatisticsC.PlotDistanceMatrix2D"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MultivariateStatisticsC.PlotDistanceMatrix2D">[docs]</a>    <span class="k">def</span> <span class="nf">PlotDistanceMatrix2D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;plot the mapped data against the date&quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minPath</span><span class="p">,</span><span class="s">&quot;o&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minPath</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MultivariateStatisticsC.PlotDistanceMatrix3D"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MultivariateStatisticsC.PlotDistanceMatrix3D">[docs]</a>    <span class="k">def</span> <span class="nf">PlotDistanceMatrix3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;plot the mapped data against the date&quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mappingMatrix</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">FindMinPathThrougData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">exclusionList</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">outputIndexList</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">outputIndexTupleList</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">rowindex</span><span class="p">,</span><span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mappingMatrix</span><span class="p">)),</span><span class="bp">self</span><span class="o">.</span><span class="n">_mappingMatrix</span><span class="p">):</span>
            <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;len row&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">),</span><span class="s">&quot;len row without duplicates: &quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="p">)))</span>
            <span class="c">#VerbosityF(0,&quot;row with index &quot;,rowindex,&quot; &quot;,row)</span>
            <span class="c">#first exclude the diagonal element</span>
            <span class="c">#exclusionList.append(row[rowindex])</span>
            <span class="c">#list of all values not in exclusion list</span>
            <span class="n">rowLi</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="c">#plt.plot(row)</span>
            <span class="n">rowFilteredLi</span><span class="o">=</span><span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">rowLi</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclusionList</span><span class="p">]</span>
            <span class="c">#print &quot;row index &quot;,rowindex,&quot; len row &quot;, len(rowLi), &quot; len filter list &quot;, len(rowFilteredLi), &quot; len exclusion list &quot;,len(exclusionList)</span>
            <span class="c">#look for the index of the maximal element of the filtered list in the total list</span>
            <span class="n">index</span><span class="o">=</span><span class="n">rowLi</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">rowFilteredLi</span><span class="p">))</span>
            <span class="c">#add this element to the exclusion list</span>
            <span class="n">exclusionList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="c">#and to the output list</span>
            <span class="n">outputIndexTupleList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rowindex</span><span class="p">,</span><span class="n">index</span><span class="p">))</span>
            <span class="n">outputIndexList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="c">#(index)</span>
            <span class="c">#for i in range(len(row)):</span>
            <span class="c">#if index not in exclusionList:</span>
            <span class="c">#exclusionList.append(index)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">minPath</span><span class="o">=</span><span class="n">outputIndexList</span>
        <span class="c">#plt.show()</span>
        <span class="n">VerbosityF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;len minPath&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minPath</span><span class="p">),</span><span class="s">&quot;len without duplicates: &quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minPath</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PhasePlot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minPath</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">PhasePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inputList</span><span class="p">):</span>
        <span class="n">deltaInputList</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">inputList</span><span class="p">)):</span>
            <span class="n">deltaInputList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inputList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">inputList</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AnaC</span><span class="o">.</span><span class="n">GetAndIncreaseGlobalFigureID</span><span class="p">())</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">inputList</span><span class="p">,</span><span class="n">deltaInputList</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">KernelWrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kernelName</span><span class="p">,</span><span class="n">team</span><span class="p">):</span>

        <span class="n">dataToAnalyze</span><span class="o">=</span><span class="p">[];</span><span class="n">dateList</span><span class="o">=</span><span class="p">[];</span><span class="n">winList</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">listElement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compactMultivariateDataAllSeasons</span><span class="p">[</span><span class="n">team</span><span class="p">]:</span>
            <span class="n">winList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listElement</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">dateList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listElement</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">dataToAnalyze</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listElement</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>

        <span class="k">if</span> <span class="n">kernelName</span><span class="o">==</span><span class="s">&quot;linear&quot;</span><span class="p">:</span>
            <span class="n">tmpMatrix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LinearKernelMapping</span><span class="p">(</span><span class="n">team</span><span class="p">,</span><span class="n">dataToAnalyze</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kernelName</span><span class="o">==</span><span class="s">&quot;rbf&quot;</span><span class="p">:</span>
            <span class="n">tmpMatrix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RBFKernelMapping</span><span class="p">(</span><span class="n">team</span><span class="p">,</span><span class="n">dataToAnalyze</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mappingMatrix</span><span class="o">=</span><span class="n">tmpMatrix</span><span class="c">#-np.diag(tmpMatrix)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mappingMatrix</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mappingMatrix</span><span class="p">)</span>

<div class="viewcode-block" id="MultivariateStatisticsC.LinearKernelMapping"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MultivariateStatisticsC.LinearKernelMapping">[docs]</a>    <span class="k">def</span> <span class="nf">LinearKernelMapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">team</span><span class="p">,</span><span class="n">dataToAnalyze</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;the linear kernel mapping multiplies each dataset(row, with N features) with the transposed of the next set</span>
<span class="sd">        is zero if datasets are orthogonal (in the space spanned by the unit vectors of input space)&quot;&quot;&quot;</span>

        <span class="n">tmpMatrix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linear_kernel</span><span class="p">(</span><span class="n">dataToAnalyze</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tmpMatrix</span>
</div>
<div class="viewcode-block" id="MultivariateStatisticsC.RBFKernelMapping"><a class="viewcode-back" href="../pyStatKs.html#pyStatKs.MultivariateStatisticsC.RBFKernelMapping">[docs]</a>    <span class="k">def</span> <span class="nf">RBFKernelMapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">team</span><span class="p">,</span><span class="n">dataToAnalyze</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;the linear kernel mapping multiplies each dataset(row, with N features) with the transposed of the next set</span>
<span class="sd">        is zero if datasets are orthogonal (in the space spanned by the unit vectors of input space)&quot;&quot;&quot;</span>

        <span class="n">tmpMatrix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rbf_kernel</span><span class="p">(</span><span class="n">dataToAnalyze</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tmpMatrix</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../pyStatKs.html">pyStatKs 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Stefan Konzett-Stoffl.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>